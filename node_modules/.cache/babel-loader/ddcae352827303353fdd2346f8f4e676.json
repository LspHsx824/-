{"ast":null,"code":"import \"core-js/modules/es.number.constructor.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.array.splice.js\";\nimport \"core-js/modules/es.array.concat.js\";\n// Utils\nimport { raf } from '../utils/dom/raf';\nimport { isDate } from '../utils/validate/date';\nimport { getScrollTop } from '../utils/dom/scroll';\nimport { t, bem, copyDate, copyDates, getNextDay, compareDay, calcDateNum, compareMonth, createComponent, getDayByOffset } from './utils'; // Components\n\nimport Popup from '../popup';\nimport Button from '../button';\nimport Toast from '../toast';\nimport Month from './components/Month';\nimport Header from './components/Header';\nexport default createComponent({\n  props: {\n    title: String,\n    color: String,\n    value: Boolean,\n    readonly: Boolean,\n    formatter: Function,\n    rowHeight: [Number, String],\n    confirmText: String,\n    rangePrompt: String,\n    defaultDate: [Date, Array],\n    getContainer: [String, Function],\n    allowSameDay: Boolean,\n    confirmDisabledText: String,\n    type: {\n      type: String,\n      default: 'single'\n    },\n    round: {\n      type: Boolean,\n      default: true\n    },\n    position: {\n      type: String,\n      default: 'bottom'\n    },\n    poppable: {\n      type: Boolean,\n      default: true\n    },\n    maxRange: {\n      type: [Number, String],\n      default: null\n    },\n    lazyRender: {\n      type: Boolean,\n      default: true\n    },\n    showMark: {\n      type: Boolean,\n      default: true\n    },\n    showTitle: {\n      type: Boolean,\n      default: true\n    },\n    showConfirm: {\n      type: Boolean,\n      default: true\n    },\n    showSubtitle: {\n      type: Boolean,\n      default: true\n    },\n    closeOnPopstate: {\n      type: Boolean,\n      default: true\n    },\n    closeOnClickOverlay: {\n      type: Boolean,\n      default: true\n    },\n    safeAreaInsetBottom: {\n      type: Boolean,\n      default: true\n    },\n    minDate: {\n      type: Date,\n      validator: isDate,\n      default: function _default() {\n        return new Date();\n      }\n    },\n    maxDate: {\n      type: Date,\n      validator: isDate,\n      default: function _default() {\n        var now = new Date();\n        return new Date(now.getFullYear(), now.getMonth() + 6, now.getDate());\n      }\n    },\n    firstDayOfWeek: {\n      type: [Number, String],\n      default: 0,\n      validator: function validator(val) {\n        return val >= 0 && val <= 6;\n      }\n    }\n  },\n  inject: {\n    vanPopup: {\n      default: null\n    }\n  },\n  data: function data() {\n    return {\n      subtitle: '',\n      currentDate: this.getInitialDate()\n    };\n  },\n  computed: {\n    months: function months() {\n      var months = [];\n      var cursor = new Date(this.minDate);\n      cursor.setDate(1);\n\n      do {\n        months.push(new Date(cursor));\n        cursor.setMonth(cursor.getMonth() + 1);\n      } while (compareMonth(cursor, this.maxDate) !== 1);\n\n      return months;\n    },\n    buttonDisabled: function buttonDisabled() {\n      var type = this.type,\n          currentDate = this.currentDate;\n\n      if (currentDate) {\n        if (type === 'range') {\n          return !currentDate[0] || !currentDate[1];\n        }\n\n        if (type === 'multiple') {\n          return !currentDate.length;\n        }\n      }\n\n      return !currentDate;\n    },\n    dayOffset: function dayOffset() {\n      return this.firstDayOfWeek ? this.firstDayOfWeek % 7 : 0;\n    }\n  },\n  watch: {\n    value: 'init',\n    type: function type() {\n      this.reset();\n    },\n    defaultDate: function defaultDate(val) {\n      this.currentDate = val;\n      this.scrollIntoView();\n    }\n  },\n  mounted: function mounted() {\n    var _this$vanPopup;\n\n    this.init(); // https://github.com/youzan/vant/issues/9845\n\n    (_this$vanPopup = this.vanPopup) == null ? void 0 : _this$vanPopup.$on('opened', this.onScroll);\n  },\n\n  /* istanbul ignore next */\n  activated: function activated() {\n    this.init();\n  },\n  methods: {\n    // @exposed-api\n    reset: function reset(date) {\n      if (date === void 0) {\n        date = this.getInitialDate();\n      }\n\n      this.currentDate = date;\n      this.scrollIntoView();\n    },\n    init: function init() {\n      var _this = this;\n\n      if (this.poppable && !this.value) {\n        return;\n      }\n\n      this.$nextTick(function () {\n        // add Math.floor to avoid decimal height issues\n        // https://github.com/youzan/vant/issues/5640\n        _this.bodyHeight = Math.floor(_this.$refs.body.getBoundingClientRect().height);\n\n        _this.onScroll();\n\n        _this.scrollIntoView();\n      });\n    },\n    // @exposed-api\n    scrollToDate: function scrollToDate(targetDate) {\n      var _this2 = this;\n\n      raf(function () {\n        var displayed = _this2.value || !_this2.poppable;\n        /* istanbul ignore if */\n\n        if (!targetDate || !displayed) {\n          return;\n        }\n\n        _this2.months.some(function (month, index) {\n          if (compareMonth(month, targetDate) === 0) {\n            var _this2$$refs = _this2.$refs,\n                body = _this2$$refs.body,\n                months = _this2$$refs.months;\n            months[index].scrollIntoView(body);\n            return true;\n          }\n\n          return false;\n        });\n\n        _this2.onScroll();\n      });\n    },\n    // scroll to current month\n    scrollIntoView: function scrollIntoView() {\n      var currentDate = this.currentDate;\n\n      if (currentDate) {\n        var targetDate = this.type === 'single' ? currentDate : currentDate[0];\n        this.scrollToDate(targetDate);\n      }\n    },\n    getInitialDate: function getInitialDate() {\n      var type = this.type,\n          minDate = this.minDate,\n          maxDate = this.maxDate,\n          defaultDate = this.defaultDate;\n\n      if (defaultDate === null) {\n        return defaultDate;\n      }\n\n      var defaultVal = new Date();\n\n      if (compareDay(defaultVal, minDate) === -1) {\n        defaultVal = minDate;\n      } else if (compareDay(defaultVal, maxDate) === 1) {\n        defaultVal = maxDate;\n      }\n\n      if (type === 'range') {\n        var _ref = defaultDate || [],\n            startDay = _ref[0],\n            endDay = _ref[1];\n\n        return [startDay || defaultVal, endDay || getNextDay(defaultVal)];\n      }\n\n      if (type === 'multiple') {\n        return defaultDate || [defaultVal];\n      }\n\n      return defaultDate || defaultVal;\n    },\n    // calculate the position of the elements\n    // and find the elements that needs to be rendered\n    onScroll: function onScroll() {\n      var _this$$refs = this.$refs,\n          body = _this$$refs.body,\n          months = _this$$refs.months;\n      var top = getScrollTop(body);\n      var bottom = top + this.bodyHeight;\n      var heights = months.map(function (item) {\n        return item.getHeight();\n      });\n      var heightSum = heights.reduce(function (a, b) {\n        return a + b;\n      }, 0); // iOS scroll bounce may exceed the range\n\n      if (bottom > heightSum && top > 0) {\n        return;\n      }\n\n      var height = 0;\n      var currentMonth;\n      var visibleRange = [-1, -1];\n\n      for (var i = 0; i < months.length; i++) {\n        var visible = height <= bottom && height + heights[i] >= top;\n\n        if (visible) {\n          visibleRange[1] = i;\n\n          if (!currentMonth) {\n            currentMonth = months[i];\n            visibleRange[0] = i;\n          }\n\n          if (!months[i].showed) {\n            months[i].showed = true;\n            this.$emit('month-show', {\n              date: months[i].date,\n              title: months[i].title\n            });\n          }\n        }\n\n        height += heights[i];\n      }\n\n      months.forEach(function (month, index) {\n        month.visible = index >= visibleRange[0] - 1 && index <= visibleRange[1] + 1;\n      });\n      /* istanbul ignore else */\n\n      if (currentMonth) {\n        this.subtitle = currentMonth.title;\n      }\n    },\n    onClickDay: function onClickDay(item) {\n      if (this.readonly) {\n        return;\n      }\n\n      var date = item.date;\n      var type = this.type,\n          currentDate = this.currentDate;\n\n      if (type === 'range') {\n        if (!currentDate) {\n          this.select([date, null]);\n          return;\n        }\n\n        var startDay = currentDate[0],\n            endDay = currentDate[1];\n\n        if (startDay && !endDay) {\n          var compareToStart = compareDay(date, startDay);\n\n          if (compareToStart === 1) {\n            this.select([startDay, date], true);\n          } else if (compareToStart === -1) {\n            this.select([date, null]);\n          } else if (this.allowSameDay) {\n            this.select([date, date], true);\n          }\n        } else {\n          this.select([date, null]);\n        }\n      } else if (type === 'multiple') {\n        if (!currentDate) {\n          this.select([date]);\n          return;\n        }\n\n        var selectedIndex;\n        var selected = this.currentDate.some(function (dateItem, index) {\n          var equal = compareDay(dateItem, date) === 0;\n\n          if (equal) {\n            selectedIndex = index;\n          }\n\n          return equal;\n        });\n\n        if (selected) {\n          var _currentDate$splice = currentDate.splice(selectedIndex, 1),\n              unselectedDate = _currentDate$splice[0];\n\n          this.$emit('unselect', copyDate(unselectedDate));\n        } else if (this.maxRange && currentDate.length >= this.maxRange) {\n          Toast(this.rangePrompt || t('rangePrompt', this.maxRange));\n        } else {\n          this.select([].concat(currentDate, [date]));\n        }\n      } else {\n        this.select(date, true);\n      }\n    },\n    togglePopup: function togglePopup(val) {\n      this.$emit('input', val);\n    },\n    select: function select(date, complete) {\n      var _this3 = this;\n\n      var emit = function emit(date) {\n        _this3.currentDate = date;\n\n        _this3.$emit('select', copyDates(_this3.currentDate));\n      };\n\n      if (complete && this.type === 'range') {\n        var valid = this.checkRange(date);\n\n        if (!valid) {\n          // auto selected to max range if showConfirm\n          if (this.showConfirm) {\n            emit([date[0], getDayByOffset(date[0], this.maxRange - 1)]);\n          } else {\n            emit(date);\n          }\n\n          return;\n        }\n      }\n\n      emit(date);\n\n      if (complete && !this.showConfirm) {\n        this.onConfirm();\n      }\n    },\n    checkRange: function checkRange(date) {\n      var maxRange = this.maxRange,\n          rangePrompt = this.rangePrompt;\n\n      if (maxRange && calcDateNum(date) > maxRange) {\n        Toast(rangePrompt || t('rangePrompt', maxRange));\n        return false;\n      }\n\n      return true;\n    },\n    onConfirm: function onConfirm() {\n      this.$emit('confirm', copyDates(this.currentDate));\n    },\n    genMonth: function genMonth(date, index) {\n      var h = this.$createElement;\n      var showMonthTitle = index !== 0 || !this.showSubtitle;\n      return h(Month, {\n        \"ref\": \"months\",\n        \"refInFor\": true,\n        \"attrs\": {\n          \"date\": date,\n          \"type\": this.type,\n          \"color\": this.color,\n          \"minDate\": this.minDate,\n          \"maxDate\": this.maxDate,\n          \"showMark\": this.showMark,\n          \"formatter\": this.formatter,\n          \"rowHeight\": this.rowHeight,\n          \"lazyRender\": this.lazyRender,\n          \"currentDate\": this.currentDate,\n          \"showSubtitle\": this.showSubtitle,\n          \"allowSameDay\": this.allowSameDay,\n          \"showMonthTitle\": showMonthTitle,\n          \"firstDayOfWeek\": this.dayOffset\n        },\n        \"scopedSlots\": {\n          'top-info': this.$scopedSlots['top-info'],\n          'bottom-info': this.$scopedSlots['bottom-info']\n        },\n        \"on\": {\n          \"click\": this.onClickDay\n        }\n      });\n    },\n    genFooterContent: function genFooterContent() {\n      var h = this.$createElement;\n      var slot = this.slots('footer');\n\n      if (slot) {\n        return slot;\n      }\n\n      if (this.showConfirm) {\n        var text = this.buttonDisabled ? this.confirmDisabledText : this.confirmText;\n        return h(Button, {\n          \"attrs\": {\n            \"round\": true,\n            \"block\": true,\n            \"type\": \"danger\",\n            \"color\": this.color,\n            \"disabled\": this.buttonDisabled,\n            \"nativeType\": \"button\"\n          },\n          \"class\": bem('confirm'),\n          \"on\": {\n            \"click\": this.onConfirm\n          }\n        }, [text || t('confirm')]);\n      }\n    },\n    genFooter: function genFooter() {\n      var h = this.$createElement;\n      return h(\"div\", {\n        \"class\": bem('footer', {\n          unfit: !this.safeAreaInsetBottom\n        })\n      }, [this.genFooterContent()]);\n    },\n    genCalendar: function genCalendar() {\n      var _this4 = this;\n\n      var h = this.$createElement;\n      return h(\"div\", {\n        \"class\": bem()\n      }, [h(Header, {\n        \"attrs\": {\n          \"title\": this.title,\n          \"showTitle\": this.showTitle,\n          \"subtitle\": this.subtitle,\n          \"showSubtitle\": this.showSubtitle,\n          \"firstDayOfWeek\": this.dayOffset\n        },\n        \"scopedSlots\": {\n          title: function title() {\n            return _this4.slots('title');\n          }\n        }\n      }), h(\"div\", {\n        \"ref\": \"body\",\n        \"class\": bem('body'),\n        \"on\": {\n          \"scroll\": this.onScroll\n        }\n      }, [this.months.map(this.genMonth)]), this.genFooter()]);\n    }\n  },\n  render: function render() {\n    var _this5 = this;\n\n    var h = arguments[0];\n\n    if (this.poppable) {\n      var _attrs;\n\n      var createListener = function createListener(name) {\n        return function () {\n          return _this5.$emit(name);\n        };\n      };\n\n      return h(Popup, {\n        \"attrs\": (_attrs = {\n          \"round\": true,\n          \"value\": this.value\n        }, _attrs[\"round\"] = this.round, _attrs[\"position\"] = this.position, _attrs[\"closeable\"] = this.showTitle || this.showSubtitle, _attrs[\"getContainer\"] = this.getContainer, _attrs[\"closeOnPopstate\"] = this.closeOnPopstate, _attrs[\"closeOnClickOverlay\"] = this.closeOnClickOverlay, _attrs),\n        \"class\": bem('popup'),\n        \"on\": {\n          \"input\": this.togglePopup,\n          \"open\": createListener('open'),\n          \"opened\": createListener('opened'),\n          \"close\": createListener('close'),\n          \"closed\": createListener('closed')\n        }\n      }, [this.genCalendar()]);\n    }\n\n    return this.genCalendar();\n  }\n});","map":{"version":3,"sources":["C:/Users/Lisp/Desktop/items/node_modules/vant/es/calendar/index.js"],"names":["raf","isDate","getScrollTop","t","bem","copyDate","copyDates","getNextDay","compareDay","calcDateNum","compareMonth","createComponent","getDayByOffset","Popup","Button","Toast","Month","Header","props","title","String","color","value","Boolean","readonly","formatter","Function","rowHeight","Number","confirmText","rangePrompt","defaultDate","Date","Array","getContainer","allowSameDay","confirmDisabledText","type","default","round","position","poppable","maxRange","lazyRender","showMark","showTitle","showConfirm","showSubtitle","closeOnPopstate","closeOnClickOverlay","safeAreaInsetBottom","minDate","validator","_default","maxDate","now","getFullYear","getMonth","getDate","firstDayOfWeek","val","inject","vanPopup","data","subtitle","currentDate","getInitialDate","computed","months","cursor","setDate","push","setMonth","buttonDisabled","length","dayOffset","watch","reset","scrollIntoView","mounted","_this$vanPopup","init","$on","onScroll","activated","methods","date","_this","$nextTick","bodyHeight","Math","floor","$refs","body","getBoundingClientRect","height","scrollToDate","targetDate","_this2","displayed","some","month","index","_this2$$refs","defaultVal","_ref","startDay","endDay","_this$$refs","top","bottom","heights","map","item","getHeight","heightSum","reduce","a","b","currentMonth","visibleRange","i","visible","showed","$emit","forEach","onClickDay","select","compareToStart","selectedIndex","selected","dateItem","equal","_currentDate$splice","splice","unselectedDate","concat","togglePopup","complete","_this3","emit","valid","checkRange","onConfirm","genMonth","h","$createElement","showMonthTitle","$scopedSlots","genFooterContent","slot","slots","text","genFooter","unfit","genCalendar","_this4","render","_this5","arguments","_attrs","createListener","name"],"mappings":"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","sourcesContent":["// Utils\nimport { raf } from '../utils/dom/raf';\nimport { isDate } from '../utils/validate/date';\nimport { getScrollTop } from '../utils/dom/scroll';\nimport { t, bem, copyDate, copyDates, getNextDay, compareDay, calcDateNum, compareMonth, createComponent, getDayByOffset } from './utils'; // Components\n\nimport Popup from '../popup';\nimport Button from '../button';\nimport Toast from '../toast';\nimport Month from './components/Month';\nimport Header from './components/Header';\nexport default createComponent({\n  props: {\n    title: String,\n    color: String,\n    value: Boolean,\n    readonly: Boolean,\n    formatter: Function,\n    rowHeight: [Number, String],\n    confirmText: String,\n    rangePrompt: String,\n    defaultDate: [Date, Array],\n    getContainer: [String, Function],\n    allowSameDay: Boolean,\n    confirmDisabledText: String,\n    type: {\n      type: String,\n      default: 'single'\n    },\n    round: {\n      type: Boolean,\n      default: true\n    },\n    position: {\n      type: String,\n      default: 'bottom'\n    },\n    poppable: {\n      type: Boolean,\n      default: true\n    },\n    maxRange: {\n      type: [Number, String],\n      default: null\n    },\n    lazyRender: {\n      type: Boolean,\n      default: true\n    },\n    showMark: {\n      type: Boolean,\n      default: true\n    },\n    showTitle: {\n      type: Boolean,\n      default: true\n    },\n    showConfirm: {\n      type: Boolean,\n      default: true\n    },\n    showSubtitle: {\n      type: Boolean,\n      default: true\n    },\n    closeOnPopstate: {\n      type: Boolean,\n      default: true\n    },\n    closeOnClickOverlay: {\n      type: Boolean,\n      default: true\n    },\n    safeAreaInsetBottom: {\n      type: Boolean,\n      default: true\n    },\n    minDate: {\n      type: Date,\n      validator: isDate,\n      default: function _default() {\n        return new Date();\n      }\n    },\n    maxDate: {\n      type: Date,\n      validator: isDate,\n      default: function _default() {\n        var now = new Date();\n        return new Date(now.getFullYear(), now.getMonth() + 6, now.getDate());\n      }\n    },\n    firstDayOfWeek: {\n      type: [Number, String],\n      default: 0,\n      validator: function validator(val) {\n        return val >= 0 && val <= 6;\n      }\n    }\n  },\n  inject: {\n    vanPopup: {\n      default: null\n    }\n  },\n  data: function data() {\n    return {\n      subtitle: '',\n      currentDate: this.getInitialDate()\n    };\n  },\n  computed: {\n    months: function months() {\n      var months = [];\n      var cursor = new Date(this.minDate);\n      cursor.setDate(1);\n\n      do {\n        months.push(new Date(cursor));\n        cursor.setMonth(cursor.getMonth() + 1);\n      } while (compareMonth(cursor, this.maxDate) !== 1);\n\n      return months;\n    },\n    buttonDisabled: function buttonDisabled() {\n      var type = this.type,\n          currentDate = this.currentDate;\n\n      if (currentDate) {\n        if (type === 'range') {\n          return !currentDate[0] || !currentDate[1];\n        }\n\n        if (type === 'multiple') {\n          return !currentDate.length;\n        }\n      }\n\n      return !currentDate;\n    },\n    dayOffset: function dayOffset() {\n      return this.firstDayOfWeek ? this.firstDayOfWeek % 7 : 0;\n    }\n  },\n  watch: {\n    value: 'init',\n    type: function type() {\n      this.reset();\n    },\n    defaultDate: function defaultDate(val) {\n      this.currentDate = val;\n      this.scrollIntoView();\n    }\n  },\n  mounted: function mounted() {\n    var _this$vanPopup;\n\n    this.init(); // https://github.com/youzan/vant/issues/9845\n\n    (_this$vanPopup = this.vanPopup) == null ? void 0 : _this$vanPopup.$on('opened', this.onScroll);\n  },\n\n  /* istanbul ignore next */\n  activated: function activated() {\n    this.init();\n  },\n  methods: {\n    // @exposed-api\n    reset: function reset(date) {\n      if (date === void 0) {\n        date = this.getInitialDate();\n      }\n\n      this.currentDate = date;\n      this.scrollIntoView();\n    },\n    init: function init() {\n      var _this = this;\n\n      if (this.poppable && !this.value) {\n        return;\n      }\n\n      this.$nextTick(function () {\n        // add Math.floor to avoid decimal height issues\n        // https://github.com/youzan/vant/issues/5640\n        _this.bodyHeight = Math.floor(_this.$refs.body.getBoundingClientRect().height);\n\n        _this.onScroll();\n\n        _this.scrollIntoView();\n      });\n    },\n    // @exposed-api\n    scrollToDate: function scrollToDate(targetDate) {\n      var _this2 = this;\n\n      raf(function () {\n        var displayed = _this2.value || !_this2.poppable;\n        /* istanbul ignore if */\n\n        if (!targetDate || !displayed) {\n          return;\n        }\n\n        _this2.months.some(function (month, index) {\n          if (compareMonth(month, targetDate) === 0) {\n            var _this2$$refs = _this2.$refs,\n                body = _this2$$refs.body,\n                months = _this2$$refs.months;\n            months[index].scrollIntoView(body);\n            return true;\n          }\n\n          return false;\n        });\n\n        _this2.onScroll();\n      });\n    },\n    // scroll to current month\n    scrollIntoView: function scrollIntoView() {\n      var currentDate = this.currentDate;\n\n      if (currentDate) {\n        var targetDate = this.type === 'single' ? currentDate : currentDate[0];\n        this.scrollToDate(targetDate);\n      }\n    },\n    getInitialDate: function getInitialDate() {\n      var type = this.type,\n          minDate = this.minDate,\n          maxDate = this.maxDate,\n          defaultDate = this.defaultDate;\n\n      if (defaultDate === null) {\n        return defaultDate;\n      }\n\n      var defaultVal = new Date();\n\n      if (compareDay(defaultVal, minDate) === -1) {\n        defaultVal = minDate;\n      } else if (compareDay(defaultVal, maxDate) === 1) {\n        defaultVal = maxDate;\n      }\n\n      if (type === 'range') {\n        var _ref = defaultDate || [],\n            startDay = _ref[0],\n            endDay = _ref[1];\n\n        return [startDay || defaultVal, endDay || getNextDay(defaultVal)];\n      }\n\n      if (type === 'multiple') {\n        return defaultDate || [defaultVal];\n      }\n\n      return defaultDate || defaultVal;\n    },\n    // calculate the position of the elements\n    // and find the elements that needs to be rendered\n    onScroll: function onScroll() {\n      var _this$$refs = this.$refs,\n          body = _this$$refs.body,\n          months = _this$$refs.months;\n      var top = getScrollTop(body);\n      var bottom = top + this.bodyHeight;\n      var heights = months.map(function (item) {\n        return item.getHeight();\n      });\n      var heightSum = heights.reduce(function (a, b) {\n        return a + b;\n      }, 0); // iOS scroll bounce may exceed the range\n\n      if (bottom > heightSum && top > 0) {\n        return;\n      }\n\n      var height = 0;\n      var currentMonth;\n      var visibleRange = [-1, -1];\n\n      for (var i = 0; i < months.length; i++) {\n        var visible = height <= bottom && height + heights[i] >= top;\n\n        if (visible) {\n          visibleRange[1] = i;\n\n          if (!currentMonth) {\n            currentMonth = months[i];\n            visibleRange[0] = i;\n          }\n\n          if (!months[i].showed) {\n            months[i].showed = true;\n            this.$emit('month-show', {\n              date: months[i].date,\n              title: months[i].title\n            });\n          }\n        }\n\n        height += heights[i];\n      }\n\n      months.forEach(function (month, index) {\n        month.visible = index >= visibleRange[0] - 1 && index <= visibleRange[1] + 1;\n      });\n      /* istanbul ignore else */\n\n      if (currentMonth) {\n        this.subtitle = currentMonth.title;\n      }\n    },\n    onClickDay: function onClickDay(item) {\n      if (this.readonly) {\n        return;\n      }\n\n      var date = item.date;\n      var type = this.type,\n          currentDate = this.currentDate;\n\n      if (type === 'range') {\n        if (!currentDate) {\n          this.select([date, null]);\n          return;\n        }\n\n        var startDay = currentDate[0],\n            endDay = currentDate[1];\n\n        if (startDay && !endDay) {\n          var compareToStart = compareDay(date, startDay);\n\n          if (compareToStart === 1) {\n            this.select([startDay, date], true);\n          } else if (compareToStart === -1) {\n            this.select([date, null]);\n          } else if (this.allowSameDay) {\n            this.select([date, date], true);\n          }\n        } else {\n          this.select([date, null]);\n        }\n      } else if (type === 'multiple') {\n        if (!currentDate) {\n          this.select([date]);\n          return;\n        }\n\n        var selectedIndex;\n        var selected = this.currentDate.some(function (dateItem, index) {\n          var equal = compareDay(dateItem, date) === 0;\n\n          if (equal) {\n            selectedIndex = index;\n          }\n\n          return equal;\n        });\n\n        if (selected) {\n          var _currentDate$splice = currentDate.splice(selectedIndex, 1),\n              unselectedDate = _currentDate$splice[0];\n\n          this.$emit('unselect', copyDate(unselectedDate));\n        } else if (this.maxRange && currentDate.length >= this.maxRange) {\n          Toast(this.rangePrompt || t('rangePrompt', this.maxRange));\n        } else {\n          this.select([].concat(currentDate, [date]));\n        }\n      } else {\n        this.select(date, true);\n      }\n    },\n    togglePopup: function togglePopup(val) {\n      this.$emit('input', val);\n    },\n    select: function select(date, complete) {\n      var _this3 = this;\n\n      var emit = function emit(date) {\n        _this3.currentDate = date;\n\n        _this3.$emit('select', copyDates(_this3.currentDate));\n      };\n\n      if (complete && this.type === 'range') {\n        var valid = this.checkRange(date);\n\n        if (!valid) {\n          // auto selected to max range if showConfirm\n          if (this.showConfirm) {\n            emit([date[0], getDayByOffset(date[0], this.maxRange - 1)]);\n          } else {\n            emit(date);\n          }\n\n          return;\n        }\n      }\n\n      emit(date);\n\n      if (complete && !this.showConfirm) {\n        this.onConfirm();\n      }\n    },\n    checkRange: function checkRange(date) {\n      var maxRange = this.maxRange,\n          rangePrompt = this.rangePrompt;\n\n      if (maxRange && calcDateNum(date) > maxRange) {\n        Toast(rangePrompt || t('rangePrompt', maxRange));\n        return false;\n      }\n\n      return true;\n    },\n    onConfirm: function onConfirm() {\n      this.$emit('confirm', copyDates(this.currentDate));\n    },\n    genMonth: function genMonth(date, index) {\n      var h = this.$createElement;\n      var showMonthTitle = index !== 0 || !this.showSubtitle;\n      return h(Month, {\n        \"ref\": \"months\",\n        \"refInFor\": true,\n        \"attrs\": {\n          \"date\": date,\n          \"type\": this.type,\n          \"color\": this.color,\n          \"minDate\": this.minDate,\n          \"maxDate\": this.maxDate,\n          \"showMark\": this.showMark,\n          \"formatter\": this.formatter,\n          \"rowHeight\": this.rowHeight,\n          \"lazyRender\": this.lazyRender,\n          \"currentDate\": this.currentDate,\n          \"showSubtitle\": this.showSubtitle,\n          \"allowSameDay\": this.allowSameDay,\n          \"showMonthTitle\": showMonthTitle,\n          \"firstDayOfWeek\": this.dayOffset\n        },\n        \"scopedSlots\": {\n          'top-info': this.$scopedSlots['top-info'],\n          'bottom-info': this.$scopedSlots['bottom-info']\n        },\n        \"on\": {\n          \"click\": this.onClickDay\n        }\n      });\n    },\n    genFooterContent: function genFooterContent() {\n      var h = this.$createElement;\n      var slot = this.slots('footer');\n\n      if (slot) {\n        return slot;\n      }\n\n      if (this.showConfirm) {\n        var text = this.buttonDisabled ? this.confirmDisabledText : this.confirmText;\n        return h(Button, {\n          \"attrs\": {\n            \"round\": true,\n            \"block\": true,\n            \"type\": \"danger\",\n            \"color\": this.color,\n            \"disabled\": this.buttonDisabled,\n            \"nativeType\": \"button\"\n          },\n          \"class\": bem('confirm'),\n          \"on\": {\n            \"click\": this.onConfirm\n          }\n        }, [text || t('confirm')]);\n      }\n    },\n    genFooter: function genFooter() {\n      var h = this.$createElement;\n      return h(\"div\", {\n        \"class\": bem('footer', {\n          unfit: !this.safeAreaInsetBottom\n        })\n      }, [this.genFooterContent()]);\n    },\n    genCalendar: function genCalendar() {\n      var _this4 = this;\n\n      var h = this.$createElement;\n      return h(\"div\", {\n        \"class\": bem()\n      }, [h(Header, {\n        \"attrs\": {\n          \"title\": this.title,\n          \"showTitle\": this.showTitle,\n          \"subtitle\": this.subtitle,\n          \"showSubtitle\": this.showSubtitle,\n          \"firstDayOfWeek\": this.dayOffset\n        },\n        \"scopedSlots\": {\n          title: function title() {\n            return _this4.slots('title');\n          }\n        }\n      }), h(\"div\", {\n        \"ref\": \"body\",\n        \"class\": bem('body'),\n        \"on\": {\n          \"scroll\": this.onScroll\n        }\n      }, [this.months.map(this.genMonth)]), this.genFooter()]);\n    }\n  },\n  render: function render() {\n    var _this5 = this;\n\n    var h = arguments[0];\n\n    if (this.poppable) {\n      var _attrs;\n\n      var createListener = function createListener(name) {\n        return function () {\n          return _this5.$emit(name);\n        };\n      };\n\n      return h(Popup, {\n        \"attrs\": (_attrs = {\n          \"round\": true,\n          \"value\": this.value\n        }, _attrs[\"round\"] = this.round, _attrs[\"position\"] = this.position, _attrs[\"closeable\"] = this.showTitle || this.showSubtitle, _attrs[\"getContainer\"] = this.getContainer, _attrs[\"closeOnPopstate\"] = this.closeOnPopstate, _attrs[\"closeOnClickOverlay\"] = this.closeOnClickOverlay, _attrs),\n        \"class\": bem('popup'),\n        \"on\": {\n          \"input\": this.togglePopup,\n          \"open\": createListener('open'),\n          \"opened\": createListener('opened'),\n          \"close\": createListener('close'),\n          \"closed\": createListener('closed')\n        }\n      }, [this.genCalendar()]);\n    }\n\n    return this.genCalendar();\n  }\n});"]},"metadata":{},"sourceType":"module"}