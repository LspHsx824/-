{"ast":null,"code":"import \"core-js/modules/es.number.constructor.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/web.url.js\";\nimport \"core-js/modules/web.url-search-params.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.array.slice.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.splice.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\"; // Utils\n\nimport { createNamespace, addUnit, noop, isPromise, isDef } from '../utils';\nimport { toArray, readFile as _readFile, isOversize, isImageFile } from './utils'; // Mixins\n\nimport { FieldMixin } from '../mixins/field'; // Components\n\nimport Icon from '../icon';\nimport Image from '../image';\nimport Loading from '../loading';\nimport ImagePreview from '../image-preview';\n\nvar _createNamespace = createNamespace('uploader'),\n    createComponent = _createNamespace[0],\n    bem = _createNamespace[1];\n\nexport default createComponent({\n  inheritAttrs: false,\n  mixins: [FieldMixin],\n  model: {\n    prop: 'fileList'\n  },\n  props: {\n    disabled: Boolean,\n    readonly: Boolean,\n    lazyLoad: Boolean,\n    uploadText: String,\n    afterRead: Function,\n    beforeRead: Function,\n    beforeDelete: Function,\n    previewSize: [Number, String],\n    previewOptions: Object,\n    name: {\n      type: [Number, String],\n      default: ''\n    },\n    accept: {\n      type: String,\n      default: 'image/*'\n    },\n    fileList: {\n      type: Array,\n      default: function _default() {\n        return [];\n      }\n    },\n    maxSize: {\n      type: [Number, String, Function],\n      default: Number.MAX_VALUE\n    },\n    maxCount: {\n      type: [Number, String],\n      default: Number.MAX_VALUE\n    },\n    deletable: {\n      type: Boolean,\n      default: true\n    },\n    showUpload: {\n      type: Boolean,\n      default: true\n    },\n    previewImage: {\n      type: Boolean,\n      default: true\n    },\n    previewFullImage: {\n      type: Boolean,\n      default: true\n    },\n    imageFit: {\n      type: String,\n      default: 'cover'\n    },\n    resultType: {\n      type: String,\n      default: 'dataUrl'\n    },\n    uploadIcon: {\n      type: String,\n      default: 'photograph'\n    }\n  },\n  computed: {\n    previewSizeWithUnit: function previewSizeWithUnit() {\n      return addUnit(this.previewSize);\n    },\n    // for form\n    value: function value() {\n      return this.fileList;\n    }\n  },\n  created: function created() {\n    this.urls = [];\n  },\n  beforeDestroy: function beforeDestroy() {\n    this.urls.forEach(function (url) {\n      return URL.revokeObjectURL(url);\n    });\n  },\n  methods: {\n    getDetail: function getDetail(index) {\n      if (index === void 0) {\n        index = this.fileList.length;\n      }\n\n      return {\n        name: this.name,\n        index: index\n      };\n    },\n    onChange: function onChange(event) {\n      var _this = this;\n\n      var files = event.target.files;\n\n      if (this.disabled || !files.length) {\n        return;\n      }\n\n      files = files.length === 1 ? files[0] : [].slice.call(files);\n\n      if (this.beforeRead) {\n        var response = this.beforeRead(files, this.getDetail());\n\n        if (!response) {\n          this.resetInput();\n          return;\n        }\n\n        if (isPromise(response)) {\n          response.then(function (data) {\n            if (data) {\n              _this.readFile(data);\n            } else {\n              _this.readFile(files);\n            }\n          }).catch(this.resetInput);\n          return;\n        }\n      }\n\n      this.readFile(files);\n    },\n    readFile: function readFile(files) {\n      var _this2 = this;\n\n      var oversize = isOversize(files, this.maxSize);\n\n      if (Array.isArray(files)) {\n        var maxCount = this.maxCount - this.fileList.length;\n\n        if (files.length > maxCount) {\n          files = files.slice(0, maxCount);\n        }\n\n        Promise.all(files.map(function (file) {\n          return _readFile(file, _this2.resultType);\n        })).then(function (contents) {\n          var fileList = files.map(function (file, index) {\n            var result = {\n              file: file,\n              status: '',\n              message: ''\n            };\n\n            if (contents[index]) {\n              result.content = contents[index];\n            }\n\n            return result;\n          });\n\n          _this2.onAfterRead(fileList, oversize);\n        });\n      } else {\n        _readFile(files, this.resultType).then(function (content) {\n          var result = {\n            file: files,\n            status: '',\n            message: ''\n          };\n\n          if (content) {\n            result.content = content;\n          }\n\n          _this2.onAfterRead(result, oversize);\n        });\n      }\n    },\n    onAfterRead: function onAfterRead(files, oversize) {\n      var _this3 = this;\n\n      this.resetInput();\n      var validFiles = files;\n\n      if (oversize) {\n        var oversizeFiles = files;\n\n        if (Array.isArray(files)) {\n          oversizeFiles = [];\n          validFiles = [];\n          files.forEach(function (item) {\n            if (item.file) {\n              if (isOversize(item.file, _this3.maxSize)) {\n                oversizeFiles.push(item);\n              } else {\n                validFiles.push(item);\n              }\n            }\n          });\n        } else {\n          validFiles = null;\n        }\n\n        this.$emit('oversize', oversizeFiles, this.getDetail());\n      }\n\n      var isValidFiles = Array.isArray(validFiles) ? Boolean(validFiles.length) : Boolean(validFiles);\n\n      if (isValidFiles) {\n        this.$emit('input', [].concat(this.fileList, toArray(validFiles)));\n\n        if (this.afterRead) {\n          this.afterRead(validFiles, this.getDetail());\n        }\n      }\n    },\n    onDelete: function onDelete(file, index) {\n      var _file$beforeDelete,\n          _this4 = this;\n\n      var beforeDelete = (_file$beforeDelete = file.beforeDelete) != null ? _file$beforeDelete : this.beforeDelete;\n\n      if (beforeDelete) {\n        var response = beforeDelete(file, this.getDetail(index));\n\n        if (!response) {\n          return;\n        }\n\n        if (isPromise(response)) {\n          response.then(function () {\n            _this4.deleteFile(file, index);\n          }).catch(noop);\n          return;\n        }\n      }\n\n      this.deleteFile(file, index);\n    },\n    deleteFile: function deleteFile(file, index) {\n      var fileList = this.fileList.slice(0);\n      fileList.splice(index, 1);\n      this.$emit('input', fileList);\n      this.$emit('delete', file, this.getDetail(index));\n    },\n    resetInput: function resetInput() {\n      /* istanbul ignore else */\n      if (this.$refs.input) {\n        this.$refs.input.value = '';\n      }\n    },\n    onClickUpload: function onClickUpload(event) {\n      this.$emit('click-upload', event);\n    },\n    onPreviewImage: function onPreviewImage(item) {\n      var _this5 = this;\n\n      if (!this.previewFullImage) {\n        return;\n      }\n\n      var imageFiles = this.fileList.filter(function (item) {\n        return isImageFile(item);\n      });\n      var imageContents = imageFiles.map(function (item) {\n        if (item.file && !item.url) {\n          item.url = URL.createObjectURL(item.file);\n\n          _this5.urls.push(item.url);\n        }\n\n        return item.url;\n      });\n      this.imagePreview = ImagePreview(_extends({\n        images: imageContents,\n        startPosition: imageFiles.indexOf(item),\n        onClose: function onClose() {\n          _this5.$emit('close-preview');\n        }\n      }, this.previewOptions));\n    },\n    // @exposed-api\n    closeImagePreview: function closeImagePreview() {\n      if (this.imagePreview) {\n        this.imagePreview.close();\n      }\n    },\n    // @exposed-api\n    chooseFile: function chooseFile() {\n      if (this.disabled) {\n        return;\n      }\n      /* istanbul ignore else */\n\n\n      if (this.$refs.input) {\n        this.$refs.input.click();\n      }\n    },\n    genPreviewMask: function genPreviewMask(item) {\n      var h = this.$createElement;\n      var status = item.status,\n          message = item.message;\n\n      if (status === 'uploading' || status === 'failed') {\n        var MaskIcon = status === 'failed' ? h(Icon, {\n          \"attrs\": {\n            \"name\": \"close\"\n          },\n          \"class\": bem('mask-icon')\n        }) : h(Loading, {\n          \"class\": bem('loading')\n        });\n        var showMessage = isDef(message) && message !== '';\n        return h(\"div\", {\n          \"class\": bem('mask')\n        }, [MaskIcon, showMessage && h(\"div\", {\n          \"class\": bem('mask-message')\n        }, [message])]);\n      }\n    },\n    genPreviewItem: function genPreviewItem(item, index) {\n      var _item$deletable,\n          _this6 = this,\n          _item$previewSize,\n          _item$imageFit;\n\n      var h = this.$createElement;\n      var deleteAble = (_item$deletable = item.deletable) != null ? _item$deletable : this.deletable;\n      var showDelete = item.status !== 'uploading' && deleteAble;\n      var DeleteIcon = showDelete && h(\"div\", {\n        \"class\": bem('preview-delete'),\n        \"on\": {\n          \"click\": function click(event) {\n            event.stopPropagation();\n\n            _this6.onDelete(item, index);\n          }\n        }\n      }, [h(Icon, {\n        \"attrs\": {\n          \"name\": \"cross\"\n        },\n        \"class\": bem('preview-delete-icon')\n      })]);\n      var PreviewCoverContent = this.slots('preview-cover', _extends({\n        index: index\n      }, item));\n      var PreviewCover = PreviewCoverContent && h(\"div\", {\n        \"class\": bem('preview-cover')\n      }, [PreviewCoverContent]);\n      var previewSize = (_item$previewSize = item.previewSize) != null ? _item$previewSize : this.previewSize;\n      var imageFit = (_item$imageFit = item.imageFit) != null ? _item$imageFit : this.imageFit;\n      var Preview = isImageFile(item) ? h(Image, {\n        \"attrs\": {\n          \"fit\": imageFit,\n          \"src\": item.content || item.url,\n          \"width\": previewSize,\n          \"height\": previewSize,\n          \"lazyLoad\": this.lazyLoad\n        },\n        \"class\": bem('preview-image'),\n        \"on\": {\n          \"click\": function click() {\n            _this6.onPreviewImage(item);\n          }\n        }\n      }, [PreviewCover]) : h(\"div\", {\n        \"class\": bem('file'),\n        \"style\": {\n          width: this.previewSizeWithUnit,\n          height: this.previewSizeWithUnit\n        }\n      }, [h(Icon, {\n        \"class\": bem('file-icon'),\n        \"attrs\": {\n          \"name\": \"description\"\n        }\n      }), h(\"div\", {\n        \"class\": [bem('file-name'), 'van-ellipsis']\n      }, [item.file ? item.file.name : item.url]), PreviewCover]);\n      return h(\"div\", {\n        \"class\": bem('preview'),\n        \"on\": {\n          \"click\": function click() {\n            _this6.$emit('click-preview', item, _this6.getDetail(index));\n          }\n        }\n      }, [Preview, this.genPreviewMask(item), DeleteIcon]);\n    },\n    genPreviewList: function genPreviewList() {\n      if (this.previewImage) {\n        return this.fileList.map(this.genPreviewItem);\n      }\n    },\n    genUpload: function genUpload() {\n      var h = this.$createElement;\n\n      if (this.fileList.length >= this.maxCount || !this.showUpload) {\n        return;\n      }\n\n      var slot = this.slots();\n      var Input = this.readonly ? null : h(\"input\", {\n        \"attrs\": _extends({}, this.$attrs, {\n          \"type\": \"file\",\n          \"accept\": this.accept,\n          \"disabled\": this.disabled\n        }),\n        \"ref\": \"input\",\n        \"class\": bem('input'),\n        \"on\": {\n          \"change\": this.onChange\n        }\n      });\n\n      if (slot) {\n        return h(\"div\", {\n          \"class\": bem('input-wrapper'),\n          \"key\": \"input-wrapper\",\n          \"on\": {\n            \"click\": this.onClickUpload\n          }\n        }, [slot, Input]);\n      }\n\n      var style;\n\n      if (this.previewSize) {\n        var size = this.previewSizeWithUnit;\n        style = {\n          width: size,\n          height: size\n        };\n      }\n\n      return h(\"div\", {\n        \"class\": bem('upload', {\n          readonly: this.readonly\n        }),\n        \"style\": style,\n        \"on\": {\n          \"click\": this.onClickUpload\n        }\n      }, [h(Icon, {\n        \"attrs\": {\n          \"name\": this.uploadIcon\n        },\n        \"class\": bem('upload-icon')\n      }), this.uploadText && h(\"span\", {\n        \"class\": bem('upload-text')\n      }, [this.uploadText]), Input]);\n    }\n  },\n  render: function render() {\n    var h = arguments[0];\n    return h(\"div\", {\n      \"class\": bem()\n    }, [h(\"div\", {\n      \"class\": bem('wrapper', {\n        disabled: this.disabled\n      })\n    }, [this.genPreviewList(), this.genUpload()])]);\n  }\n});","map":{"version":3,"sources":["C:/Users/Lisp/Desktop/Vue-app/items/node_modules/vant/es/uploader/index.js"],"names":["_extends","createNamespace","addUnit","noop","isPromise","isDef","toArray","readFile","_readFile","isOversize","isImageFile","FieldMixin","Icon","Image","Loading","ImagePreview","_createNamespace","createComponent","bem","inheritAttrs","mixins","model","prop","props","disabled","Boolean","readonly","lazyLoad","uploadText","String","afterRead","Function","beforeRead","beforeDelete","previewSize","Number","previewOptions","Object","name","type","default","accept","fileList","Array","_default","maxSize","MAX_VALUE","maxCount","deletable","showUpload","previewImage","previewFullImage","imageFit","resultType","uploadIcon","computed","previewSizeWithUnit","value","created","urls","beforeDestroy","forEach","url","URL","revokeObjectURL","methods","getDetail","index","length","onChange","event","_this","files","target","slice","call","response","resetInput","then","data","catch","_this2","oversize","isArray","Promise","all","map","file","contents","result","status","message","content","onAfterRead","_this3","validFiles","oversizeFiles","item","push","$emit","isValidFiles","concat","onDelete","_file$beforeDelete","_this4","deleteFile","splice","$refs","input","onClickUpload","onPreviewImage","_this5","imageFiles","filter","imageContents","createObjectURL","imagePreview","images","startPosition","indexOf","onClose","closeImagePreview","close","chooseFile","click","genPreviewMask","h","$createElement","MaskIcon","showMessage","genPreviewItem","_item$deletable","_this6","_item$previewSize","_item$imageFit","deleteAble","showDelete","DeleteIcon","stopPropagation","PreviewCoverContent","slots","PreviewCover","Preview","width","height","genPreviewList","genUpload","slot","Input","$attrs","style","size","render","arguments"],"mappings":"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","sourcesContent":["import _extends from \"@babel/runtime/helpers/esm/extends\";\n// Utils\nimport { createNamespace, addUnit, noop, isPromise, isDef } from '../utils';\nimport { toArray, readFile as _readFile, isOversize, isImageFile } from './utils'; // Mixins\n\nimport { FieldMixin } from '../mixins/field'; // Components\n\nimport Icon from '../icon';\nimport Image from '../image';\nimport Loading from '../loading';\nimport ImagePreview from '../image-preview';\n\nvar _createNamespace = createNamespace('uploader'),\n    createComponent = _createNamespace[0],\n    bem = _createNamespace[1];\n\nexport default createComponent({\n  inheritAttrs: false,\n  mixins: [FieldMixin],\n  model: {\n    prop: 'fileList'\n  },\n  props: {\n    disabled: Boolean,\n    readonly: Boolean,\n    lazyLoad: Boolean,\n    uploadText: String,\n    afterRead: Function,\n    beforeRead: Function,\n    beforeDelete: Function,\n    previewSize: [Number, String],\n    previewOptions: Object,\n    name: {\n      type: [Number, String],\n      default: ''\n    },\n    accept: {\n      type: String,\n      default: 'image/*'\n    },\n    fileList: {\n      type: Array,\n      default: function _default() {\n        return [];\n      }\n    },\n    maxSize: {\n      type: [Number, String, Function],\n      default: Number.MAX_VALUE\n    },\n    maxCount: {\n      type: [Number, String],\n      default: Number.MAX_VALUE\n    },\n    deletable: {\n      type: Boolean,\n      default: true\n    },\n    showUpload: {\n      type: Boolean,\n      default: true\n    },\n    previewImage: {\n      type: Boolean,\n      default: true\n    },\n    previewFullImage: {\n      type: Boolean,\n      default: true\n    },\n    imageFit: {\n      type: String,\n      default: 'cover'\n    },\n    resultType: {\n      type: String,\n      default: 'dataUrl'\n    },\n    uploadIcon: {\n      type: String,\n      default: 'photograph'\n    }\n  },\n  computed: {\n    previewSizeWithUnit: function previewSizeWithUnit() {\n      return addUnit(this.previewSize);\n    },\n    // for form\n    value: function value() {\n      return this.fileList;\n    }\n  },\n  created: function created() {\n    this.urls = [];\n  },\n  beforeDestroy: function beforeDestroy() {\n    this.urls.forEach(function (url) {\n      return URL.revokeObjectURL(url);\n    });\n  },\n  methods: {\n    getDetail: function getDetail(index) {\n      if (index === void 0) {\n        index = this.fileList.length;\n      }\n\n      return {\n        name: this.name,\n        index: index\n      };\n    },\n    onChange: function onChange(event) {\n      var _this = this;\n\n      var files = event.target.files;\n\n      if (this.disabled || !files.length) {\n        return;\n      }\n\n      files = files.length === 1 ? files[0] : [].slice.call(files);\n\n      if (this.beforeRead) {\n        var response = this.beforeRead(files, this.getDetail());\n\n        if (!response) {\n          this.resetInput();\n          return;\n        }\n\n        if (isPromise(response)) {\n          response.then(function (data) {\n            if (data) {\n              _this.readFile(data);\n            } else {\n              _this.readFile(files);\n            }\n          }).catch(this.resetInput);\n          return;\n        }\n      }\n\n      this.readFile(files);\n    },\n    readFile: function readFile(files) {\n      var _this2 = this;\n\n      var oversize = isOversize(files, this.maxSize);\n\n      if (Array.isArray(files)) {\n        var maxCount = this.maxCount - this.fileList.length;\n\n        if (files.length > maxCount) {\n          files = files.slice(0, maxCount);\n        }\n\n        Promise.all(files.map(function (file) {\n          return _readFile(file, _this2.resultType);\n        })).then(function (contents) {\n          var fileList = files.map(function (file, index) {\n            var result = {\n              file: file,\n              status: '',\n              message: ''\n            };\n\n            if (contents[index]) {\n              result.content = contents[index];\n            }\n\n            return result;\n          });\n\n          _this2.onAfterRead(fileList, oversize);\n        });\n      } else {\n        _readFile(files, this.resultType).then(function (content) {\n          var result = {\n            file: files,\n            status: '',\n            message: ''\n          };\n\n          if (content) {\n            result.content = content;\n          }\n\n          _this2.onAfterRead(result, oversize);\n        });\n      }\n    },\n    onAfterRead: function onAfterRead(files, oversize) {\n      var _this3 = this;\n\n      this.resetInput();\n      var validFiles = files;\n\n      if (oversize) {\n        var oversizeFiles = files;\n\n        if (Array.isArray(files)) {\n          oversizeFiles = [];\n          validFiles = [];\n          files.forEach(function (item) {\n            if (item.file) {\n              if (isOversize(item.file, _this3.maxSize)) {\n                oversizeFiles.push(item);\n              } else {\n                validFiles.push(item);\n              }\n            }\n          });\n        } else {\n          validFiles = null;\n        }\n\n        this.$emit('oversize', oversizeFiles, this.getDetail());\n      }\n\n      var isValidFiles = Array.isArray(validFiles) ? Boolean(validFiles.length) : Boolean(validFiles);\n\n      if (isValidFiles) {\n        this.$emit('input', [].concat(this.fileList, toArray(validFiles)));\n\n        if (this.afterRead) {\n          this.afterRead(validFiles, this.getDetail());\n        }\n      }\n    },\n    onDelete: function onDelete(file, index) {\n      var _file$beforeDelete,\n          _this4 = this;\n\n      var beforeDelete = (_file$beforeDelete = file.beforeDelete) != null ? _file$beforeDelete : this.beforeDelete;\n\n      if (beforeDelete) {\n        var response = beforeDelete(file, this.getDetail(index));\n\n        if (!response) {\n          return;\n        }\n\n        if (isPromise(response)) {\n          response.then(function () {\n            _this4.deleteFile(file, index);\n          }).catch(noop);\n          return;\n        }\n      }\n\n      this.deleteFile(file, index);\n    },\n    deleteFile: function deleteFile(file, index) {\n      var fileList = this.fileList.slice(0);\n      fileList.splice(index, 1);\n      this.$emit('input', fileList);\n      this.$emit('delete', file, this.getDetail(index));\n    },\n    resetInput: function resetInput() {\n      /* istanbul ignore else */\n      if (this.$refs.input) {\n        this.$refs.input.value = '';\n      }\n    },\n    onClickUpload: function onClickUpload(event) {\n      this.$emit('click-upload', event);\n    },\n    onPreviewImage: function onPreviewImage(item) {\n      var _this5 = this;\n\n      if (!this.previewFullImage) {\n        return;\n      }\n\n      var imageFiles = this.fileList.filter(function (item) {\n        return isImageFile(item);\n      });\n      var imageContents = imageFiles.map(function (item) {\n        if (item.file && !item.url) {\n          item.url = URL.createObjectURL(item.file);\n\n          _this5.urls.push(item.url);\n        }\n\n        return item.url;\n      });\n      this.imagePreview = ImagePreview(_extends({\n        images: imageContents,\n        startPosition: imageFiles.indexOf(item),\n        onClose: function onClose() {\n          _this5.$emit('close-preview');\n        }\n      }, this.previewOptions));\n    },\n    // @exposed-api\n    closeImagePreview: function closeImagePreview() {\n      if (this.imagePreview) {\n        this.imagePreview.close();\n      }\n    },\n    // @exposed-api\n    chooseFile: function chooseFile() {\n      if (this.disabled) {\n        return;\n      }\n      /* istanbul ignore else */\n\n\n      if (this.$refs.input) {\n        this.$refs.input.click();\n      }\n    },\n    genPreviewMask: function genPreviewMask(item) {\n      var h = this.$createElement;\n      var status = item.status,\n          message = item.message;\n\n      if (status === 'uploading' || status === 'failed') {\n        var MaskIcon = status === 'failed' ? h(Icon, {\n          \"attrs\": {\n            \"name\": \"close\"\n          },\n          \"class\": bem('mask-icon')\n        }) : h(Loading, {\n          \"class\": bem('loading')\n        });\n        var showMessage = isDef(message) && message !== '';\n        return h(\"div\", {\n          \"class\": bem('mask')\n        }, [MaskIcon, showMessage && h(\"div\", {\n          \"class\": bem('mask-message')\n        }, [message])]);\n      }\n    },\n    genPreviewItem: function genPreviewItem(item, index) {\n      var _item$deletable,\n          _this6 = this,\n          _item$previewSize,\n          _item$imageFit;\n\n      var h = this.$createElement;\n      var deleteAble = (_item$deletable = item.deletable) != null ? _item$deletable : this.deletable;\n      var showDelete = item.status !== 'uploading' && deleteAble;\n      var DeleteIcon = showDelete && h(\"div\", {\n        \"class\": bem('preview-delete'),\n        \"on\": {\n          \"click\": function click(event) {\n            event.stopPropagation();\n\n            _this6.onDelete(item, index);\n          }\n        }\n      }, [h(Icon, {\n        \"attrs\": {\n          \"name\": \"cross\"\n        },\n        \"class\": bem('preview-delete-icon')\n      })]);\n      var PreviewCoverContent = this.slots('preview-cover', _extends({\n        index: index\n      }, item));\n      var PreviewCover = PreviewCoverContent && h(\"div\", {\n        \"class\": bem('preview-cover')\n      }, [PreviewCoverContent]);\n      var previewSize = (_item$previewSize = item.previewSize) != null ? _item$previewSize : this.previewSize;\n      var imageFit = (_item$imageFit = item.imageFit) != null ? _item$imageFit : this.imageFit;\n      var Preview = isImageFile(item) ? h(Image, {\n        \"attrs\": {\n          \"fit\": imageFit,\n          \"src\": item.content || item.url,\n          \"width\": previewSize,\n          \"height\": previewSize,\n          \"lazyLoad\": this.lazyLoad\n        },\n        \"class\": bem('preview-image'),\n        \"on\": {\n          \"click\": function click() {\n            _this6.onPreviewImage(item);\n          }\n        }\n      }, [PreviewCover]) : h(\"div\", {\n        \"class\": bem('file'),\n        \"style\": {\n          width: this.previewSizeWithUnit,\n          height: this.previewSizeWithUnit\n        }\n      }, [h(Icon, {\n        \"class\": bem('file-icon'),\n        \"attrs\": {\n          \"name\": \"description\"\n        }\n      }), h(\"div\", {\n        \"class\": [bem('file-name'), 'van-ellipsis']\n      }, [item.file ? item.file.name : item.url]), PreviewCover]);\n      return h(\"div\", {\n        \"class\": bem('preview'),\n        \"on\": {\n          \"click\": function click() {\n            _this6.$emit('click-preview', item, _this6.getDetail(index));\n          }\n        }\n      }, [Preview, this.genPreviewMask(item), DeleteIcon]);\n    },\n    genPreviewList: function genPreviewList() {\n      if (this.previewImage) {\n        return this.fileList.map(this.genPreviewItem);\n      }\n    },\n    genUpload: function genUpload() {\n      var h = this.$createElement;\n\n      if (this.fileList.length >= this.maxCount || !this.showUpload) {\n        return;\n      }\n\n      var slot = this.slots();\n      var Input = this.readonly ? null : h(\"input\", {\n        \"attrs\": _extends({}, this.$attrs, {\n          \"type\": \"file\",\n          \"accept\": this.accept,\n          \"disabled\": this.disabled\n        }),\n        \"ref\": \"input\",\n        \"class\": bem('input'),\n        \"on\": {\n          \"change\": this.onChange\n        }\n      });\n\n      if (slot) {\n        return h(\"div\", {\n          \"class\": bem('input-wrapper'),\n          \"key\": \"input-wrapper\",\n          \"on\": {\n            \"click\": this.onClickUpload\n          }\n        }, [slot, Input]);\n      }\n\n      var style;\n\n      if (this.previewSize) {\n        var size = this.previewSizeWithUnit;\n        style = {\n          width: size,\n          height: size\n        };\n      }\n\n      return h(\"div\", {\n        \"class\": bem('upload', {\n          readonly: this.readonly\n        }),\n        \"style\": style,\n        \"on\": {\n          \"click\": this.onClickUpload\n        }\n      }, [h(Icon, {\n        \"attrs\": {\n          \"name\": this.uploadIcon\n        },\n        \"class\": bem('upload-icon')\n      }), this.uploadText && h(\"span\", {\n        \"class\": bem('upload-text')\n      }, [this.uploadText]), Input]);\n    }\n  },\n  render: function render() {\n    var h = arguments[0];\n    return h(\"div\", {\n      \"class\": bem()\n    }, [h(\"div\", {\n      \"class\": bem('wrapper', {\n        disabled: this.disabled\n      })\n    }, [this.genPreviewList(), this.genUpload()])]);\n  }\n});"]},"metadata":{},"sourceType":"module"}