{"ast":null,"code":"import \"core-js/modules/es.number.constructor.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/es.number.to-fixed.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.join.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.array.splice.js\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport Vue from 'vue';\nimport Popup from '../popup';\nimport Toast from '../toast';\nimport ImagePreview from '../image-preview';\nimport SkuHeader from './components/SkuHeader';\nimport SkuHeaderItem from './components/SkuHeaderItem';\nimport SkuRow from './components/SkuRow';\nimport SkuRowItem from './components/SkuRowItem';\nimport SkuRowPropItem from './components/SkuRowPropItem';\nimport SkuStepper from './components/SkuStepper';\nimport SkuMessages from './components/SkuMessages';\nimport SkuActions from './components/SkuActions';\nimport { createNamespace, isEmpty } from '../utils';\nimport { isAllSelected, isSkuChoosable, getSkuComb, getSelectedSkuValues, getSelectedPropValues, getSelectedProperties } from './utils/sku-helper';\nimport { LIMIT_TYPE, UNSELECTED_SKU_VALUE_ID } from './constants';\nvar namespace = createNamespace('sku');\nvar createComponent = namespace[0],\n    bem = namespace[1],\n    t = namespace[2];\nvar QUOTA_LIMIT = LIMIT_TYPE.QUOTA_LIMIT;\nexport default createComponent({\n  props: {\n    sku: Object,\n    goods: Object,\n    value: Boolean,\n    buyText: String,\n    goodsId: [Number, String],\n    priceTag: String,\n    lazyLoad: Boolean,\n    hideStock: Boolean,\n    properties: Array,\n    addCartText: String,\n    stepperTitle: String,\n    getContainer: [String, Function],\n    hideQuotaText: Boolean,\n    hideSelectedText: Boolean,\n    resetStepperOnHide: Boolean,\n    customSkuValidator: Function,\n    disableStepperInput: Boolean,\n    resetSelectedSkuOnHide: Boolean,\n    quota: {\n      type: Number,\n      default: 0\n    },\n    quotaUsed: {\n      type: Number,\n      default: 0\n    },\n    startSaleNum: {\n      type: Number,\n      default: 1\n    },\n    initialSku: {\n      type: Object,\n      default: function _default() {\n        return {};\n      }\n    },\n    stockThreshold: {\n      type: Number,\n      default: 50\n    },\n    showSoldoutSku: {\n      type: Boolean,\n      default: true\n    },\n    showAddCartBtn: {\n      type: Boolean,\n      default: true\n    },\n    disableSoldoutSku: {\n      type: Boolean,\n      default: true\n    },\n    customStepperConfig: {\n      type: Object,\n      default: function _default() {\n        return {};\n      }\n    },\n    showHeaderImage: {\n      type: Boolean,\n      default: true\n    },\n    previewOnClickImage: {\n      type: Boolean,\n      default: true\n    },\n    safeAreaInsetBottom: {\n      type: Boolean,\n      default: true\n    },\n    closeOnClickOverlay: {\n      type: Boolean,\n      default: true\n    },\n    bodyOffsetTop: {\n      type: Number,\n      default: 200\n    },\n    messageConfig: {\n      type: Object,\n      default: function _default() {\n        return {\n          initialMessages: {},\n          placeholderMap: {},\n          uploadImg: function uploadImg() {\n            return Promise.resolve();\n          },\n          uploadMaxSize: 5\n        };\n      }\n    }\n  },\n  data: function data() {\n    return {\n      selectedSku: {},\n      selectedProp: {},\n      selectedNum: 1,\n      show: this.value\n    };\n  },\n  watch: {\n    show: function show(val) {\n      this.$emit('input', val);\n\n      if (!val) {\n        this.$emit('sku-close', {\n          selectedSkuValues: this.selectedSkuValues,\n          selectedNum: this.selectedNum,\n          selectedSkuComb: this.selectedSkuComb\n        });\n\n        if (this.resetStepperOnHide) {\n          this.resetStepper();\n        }\n\n        if (this.resetSelectedSkuOnHide) {\n          this.resetSelectedSku();\n        }\n      }\n    },\n    value: function value(val) {\n      this.show = val;\n    },\n    skuTree: 'resetSelectedSku',\n    initialSku: function initialSku() {\n      this.resetStepper();\n      this.resetSelectedSku();\n    }\n  },\n  computed: {\n    skuGroupClass: function skuGroupClass() {\n      return ['van-sku-group-container', {\n        'van-sku-group-container--hide-soldout': !this.showSoldoutSku\n      }];\n    },\n    bodyStyle: function bodyStyle() {\n      if (this.$isServer) {\n        return;\n      }\n\n      var maxHeight = window.innerHeight - this.bodyOffsetTop;\n      return {\n        maxHeight: maxHeight + 'px'\n      };\n    },\n    isSkuCombSelected: function isSkuCombSelected() {\n      var _this = this; // SKU 未选完\n\n\n      if (this.hasSku && !isAllSelected(this.skuTree, this.selectedSku)) {\n        return false;\n      } // 属性未全选\n\n\n      return !this.propList.filter(function (i) {\n        return i.is_necessary !== false;\n      }).some(function (i) {\n        return (_this.selectedProp[i.k_id] || []).length === 0;\n      });\n    },\n    isSkuEmpty: function isSkuEmpty() {\n      return Object.keys(this.sku).length === 0;\n    },\n    hasSku: function hasSku() {\n      return !this.sku.none_sku;\n    },\n    hasSkuOrAttr: function hasSkuOrAttr() {\n      return this.hasSku || this.propList.length > 0;\n    },\n    selectedSkuComb: function selectedSkuComb() {\n      var skuComb = null;\n\n      if (this.isSkuCombSelected) {\n        if (this.hasSku) {\n          skuComb = getSkuComb(this.skuList, this.selectedSku);\n        } else {\n          skuComb = {\n            id: this.sku.collection_id,\n            price: Math.round(this.sku.price * 100),\n            stock_num: this.sku.stock_num\n          };\n        }\n\n        if (skuComb) {\n          skuComb.properties = getSelectedProperties(this.propList, this.selectedProp);\n          skuComb.property_price = this.selectedPropValues.reduce(function (acc, cur) {\n            return acc + (cur.price || 0);\n          }, 0);\n        }\n      }\n\n      return skuComb;\n    },\n    selectedSkuValues: function selectedSkuValues() {\n      return getSelectedSkuValues(this.skuTree, this.selectedSku);\n    },\n    selectedPropValues: function selectedPropValues() {\n      return getSelectedPropValues(this.propList, this.selectedProp);\n    },\n    price: function price() {\n      if (this.selectedSkuComb) {\n        return ((this.selectedSkuComb.price + this.selectedSkuComb.property_price) / 100).toFixed(2);\n      } // sku.price是一个格式化好的价格区间\n\n\n      return this.sku.price;\n    },\n    originPrice: function originPrice() {\n      if (this.selectedSkuComb && this.selectedSkuComb.origin_price) {\n        return ((this.selectedSkuComb.origin_price + this.selectedSkuComb.property_price) / 100).toFixed(2);\n      }\n\n      return this.sku.origin_price;\n    },\n    skuTree: function skuTree() {\n      return this.sku.tree || [];\n    },\n    skuList: function skuList() {\n      return this.sku.list || [];\n    },\n    propList: function propList() {\n      return this.properties || [];\n    },\n    imageList: function imageList() {\n      var imageList = [this.goods.picture];\n\n      if (this.skuTree.length > 0) {\n        this.skuTree.forEach(function (treeItem) {\n          if (!treeItem.v) {\n            return;\n          }\n\n          treeItem.v.forEach(function (vItem) {\n            var imgUrl = vItem.previewImgUrl || vItem.imgUrl || vItem.img_url;\n\n            if (imgUrl && imageList.indexOf(imgUrl) === -1) {\n              imageList.push(imgUrl);\n            }\n          });\n        });\n      }\n\n      return imageList;\n    },\n    stock: function stock() {\n      var stockNum = this.customStepperConfig.stockNum;\n\n      if (stockNum !== undefined) {\n        return stockNum;\n      }\n\n      if (this.selectedSkuComb) {\n        return this.selectedSkuComb.stock_num;\n      }\n\n      return this.sku.stock_num;\n    },\n    stockText: function stockText() {\n      var h = this.$createElement;\n      var stockFormatter = this.customStepperConfig.stockFormatter;\n\n      if (stockFormatter) {\n        return stockFormatter(this.stock);\n      }\n\n      return [t('stock') + \" \", h(\"span\", {\n        \"class\": bem('stock-num', {\n          highlight: this.stock < this.stockThreshold\n        })\n      }, [this.stock]), \" \" + t('stockUnit')];\n    },\n    selectedText: function selectedText() {\n      var _this2 = this;\n\n      if (this.selectedSkuComb) {\n        var values = this.selectedSkuValues.concat(this.selectedPropValues);\n        return t('selected') + \" \" + values.map(function (item) {\n          return item.name;\n        }).join(' ');\n      }\n\n      var unselectedSku = this.skuTree.filter(function (item) {\n        return _this2.selectedSku[item.k_s] === UNSELECTED_SKU_VALUE_ID;\n      }).map(function (item) {\n        return item.k;\n      });\n      var unselectedProp = this.propList.filter(function (item) {\n        return (_this2.selectedProp[item.k_id] || []).length < 1;\n      }).map(function (item) {\n        return item.k;\n      });\n      return t('select') + \" \" + unselectedSku.concat(unselectedProp).join(' ');\n    }\n  },\n  created: function created() {\n    var skuEventBus = new Vue();\n    this.skuEventBus = skuEventBus;\n    skuEventBus.$on('sku:select', this.onSelect);\n    skuEventBus.$on('sku:propSelect', this.onPropSelect);\n    skuEventBus.$on('sku:numChange', this.onNumChange);\n    skuEventBus.$on('sku:previewImage', this.onPreviewImage);\n    skuEventBus.$on('sku:overLimit', this.onOverLimit);\n    skuEventBus.$on('sku:stepperState', this.onStepperState);\n    skuEventBus.$on('sku:addCart', this.onAddCart);\n    skuEventBus.$on('sku:buy', this.onBuy);\n    this.resetStepper();\n    this.resetSelectedSku(); // 组件初始化后的钩子，抛出skuEventBus\n\n    this.$emit('after-sku-create', skuEventBus);\n  },\n  methods: {\n    resetStepper: function resetStepper() {\n      var skuStepper = this.$refs.skuStepper;\n      var selectedNum = this.initialSku.selectedNum;\n      var num = selectedNum != null ? selectedNum : this.startSaleNum; // 用来缓存不合法的情况\n\n      this.stepperError = null;\n\n      if (skuStepper) {\n        skuStepper.setCurrentNum(num);\n      } else {\n        // 当首次加载（skuStepper 为空）时，传入数量如果不合法，可能会存在问题\n        this.selectedNum = num;\n      }\n    },\n    // @exposed-api\n    resetSelectedSku: function resetSelectedSku() {\n      var _this3 = this;\n\n      this.selectedSku = {}; // 重置 selectedSku\n\n      this.skuTree.forEach(function (item) {\n        _this3.selectedSku[item.k_s] = UNSELECTED_SKU_VALUE_ID;\n      });\n      this.skuTree.forEach(function (item) {\n        var key = item.k_s; // 规格值只有1个时，优先判断\n\n        var valueId = item.v.length === 1 ? item.v[0].id : _this3.initialSku[key];\n\n        if (valueId && isSkuChoosable(_this3.skuList, _this3.selectedSku, {\n          key: key,\n          valueId: valueId\n        })) {\n          _this3.selectedSku[key] = valueId;\n        }\n      });\n      var skuValues = this.selectedSkuValues;\n\n      if (skuValues.length > 0) {\n        this.$nextTick(function () {\n          _this3.$emit('sku-selected', {\n            skuValue: skuValues[skuValues.length - 1],\n            selectedSku: _this3.selectedSku,\n            selectedSkuComb: _this3.selectedSkuComb\n          });\n        });\n      } // 重置商品属性\n\n\n      this.selectedProp = {};\n      var _this$initialSku$sele = this.initialSku.selectedProp,\n          selectedProp = _this$initialSku$sele === void 0 ? {} : _this$initialSku$sele; // 选中外部传入信息\n\n      this.propList.forEach(function (item) {\n        if (selectedProp[item.k_id]) {\n          _this3.selectedProp[item.k_id] = selectedProp[item.k_id];\n        }\n      });\n\n      if (isEmpty(this.selectedProp)) {\n        this.propList.forEach(function (item) {\n          var _item$v; // 没有加价的属性，默认选中第一个\n\n\n          if ((item == null ? void 0 : (_item$v = item.v) == null ? void 0 : _item$v.length) > 0) {\n            var v = item.v,\n                k_id = item.k_id;\n            var isHasConfigPrice = v.some(function (i) {\n              return +i.price !== 0;\n            });\n\n            if (!isHasConfigPrice) {\n              _this3.selectedProp[k_id] = [v[0].id];\n            }\n          }\n        });\n      }\n\n      var propValues = this.selectedPropValues;\n\n      if (propValues.length > 0) {\n        this.$emit('sku-prop-selected', {\n          propValue: propValues[propValues.length - 1],\n          selectedProp: this.selectedProp,\n          selectedSkuComb: this.selectedSkuComb\n        });\n      } // 抛出重置事件\n\n\n      this.$emit('sku-reset', {\n        selectedSku: this.selectedSku,\n        selectedProp: this.selectedProp,\n        selectedSkuComb: this.selectedSkuComb\n      });\n      this.centerInitialSku();\n    },\n    getSkuMessages: function getSkuMessages() {\n      return this.$refs.skuMessages ? this.$refs.skuMessages.getMessages() : {};\n    },\n    getSkuCartMessages: function getSkuCartMessages() {\n      return this.$refs.skuMessages ? this.$refs.skuMessages.getCartMessages() : {};\n    },\n    validateSkuMessages: function validateSkuMessages() {\n      return this.$refs.skuMessages ? this.$refs.skuMessages.validateMessages() : '';\n    },\n    validateSku: function validateSku() {\n      if (this.selectedNum === 0) {\n        return t('unavailable');\n      }\n\n      if (this.isSkuCombSelected) {\n        return this.validateSkuMessages();\n      } // 自定义sku校验\n\n\n      if (this.customSkuValidator) {\n        var err = this.customSkuValidator(this);\n        if (err) return err;\n      }\n\n      return t('selectSku');\n    },\n    onSelect: function onSelect(skuValue) {\n      var _extends2, _extends3; // 点击已选中的sku时则取消选中\n\n\n      this.selectedSku = this.selectedSku[skuValue.skuKeyStr] === skuValue.id ? _extends({}, this.selectedSku, (_extends2 = {}, _extends2[skuValue.skuKeyStr] = UNSELECTED_SKU_VALUE_ID, _extends2)) : _extends({}, this.selectedSku, (_extends3 = {}, _extends3[skuValue.skuKeyStr] = skuValue.id, _extends3));\n      this.$emit('sku-selected', {\n        skuValue: skuValue,\n        selectedSku: this.selectedSku,\n        selectedSkuComb: this.selectedSkuComb\n      });\n    },\n    onPropSelect: function onPropSelect(propValue) {\n      var _extends4;\n\n      var arr = this.selectedProp[propValue.skuKeyStr] || [];\n      var pos = arr.indexOf(propValue.id);\n\n      if (pos > -1) {\n        arr.splice(pos, 1);\n      } else if (propValue.multiple) {\n        arr.push(propValue.id);\n      } else {\n        arr.splice(0, 1, propValue.id);\n      }\n\n      this.selectedProp = _extends({}, this.selectedProp, (_extends4 = {}, _extends4[propValue.skuKeyStr] = arr, _extends4));\n      this.$emit('sku-prop-selected', {\n        propValue: propValue,\n        selectedProp: this.selectedProp,\n        selectedSkuComb: this.selectedSkuComb\n      });\n    },\n    onNumChange: function onNumChange(num) {\n      this.selectedNum = num;\n    },\n    onPreviewImage: function onPreviewImage(selectedValue) {\n      var _this4 = this;\n\n      var imageList = this.imageList;\n      var index = 0;\n      var indexImage = imageList[0];\n\n      if (selectedValue && selectedValue.imgUrl) {\n        this.imageList.some(function (image, pos) {\n          if (image === selectedValue.imgUrl) {\n            index = pos;\n            return true;\n          }\n\n          return false;\n        });\n        indexImage = selectedValue.imgUrl;\n      }\n\n      var params = _extends({}, selectedValue, {\n        index: index,\n        imageList: this.imageList,\n        indexImage: indexImage\n      });\n\n      this.$emit('open-preview', params);\n\n      if (!this.previewOnClickImage) {\n        return;\n      }\n\n      ImagePreview({\n        images: this.imageList,\n        startPosition: index,\n        onClose: function onClose() {\n          _this4.$emit('close-preview', params);\n        }\n      });\n    },\n    onOverLimit: function onOverLimit(data) {\n      var action = data.action,\n          limitType = data.limitType,\n          quota = data.quota,\n          quotaUsed = data.quotaUsed;\n      var handleOverLimit = this.customStepperConfig.handleOverLimit;\n\n      if (handleOverLimit) {\n        handleOverLimit(data);\n        return;\n      }\n\n      if (action === 'minus') {\n        if (this.startSaleNum > 1) {\n          Toast(t('minusStartTip', this.startSaleNum));\n        } else {\n          Toast(t('minusTip'));\n        }\n      } else if (action === 'plus') {\n        if (limitType === QUOTA_LIMIT) {\n          if (quotaUsed > 0) {\n            Toast(t('quotaUsedTip', quota, quotaUsed));\n          } else {\n            Toast(t('quotaTip', quota));\n          }\n        } else {\n          Toast(t('soldout'));\n        }\n      }\n    },\n    onStepperState: function onStepperState(data) {\n      this.stepperError = data.valid ? null : _extends({}, data, {\n        action: 'plus'\n      });\n    },\n    onAddCart: function onAddCart() {\n      this.onBuyOrAddCart('add-cart');\n    },\n    onBuy: function onBuy() {\n      this.onBuyOrAddCart('buy-clicked');\n    },\n    onBuyOrAddCart: function onBuyOrAddCart(type) {\n      // sku 不符合购买条件\n      if (this.stepperError) {\n        return this.onOverLimit(this.stepperError);\n      }\n\n      var error = this.validateSku();\n\n      if (error) {\n        Toast(error);\n      } else {\n        this.$emit(type, this.getSkuData());\n      }\n    },\n    // @exposed-api\n    getSkuData: function getSkuData() {\n      return {\n        goodsId: this.goodsId,\n        messages: this.getSkuMessages(),\n        selectedNum: this.selectedNum,\n        cartMessages: this.getSkuCartMessages(),\n        selectedSkuComb: this.selectedSkuComb\n      };\n    },\n    // 当 popup 完全打开后执行\n    onOpened: function onOpened() {\n      this.centerInitialSku();\n    },\n    centerInitialSku: function centerInitialSku() {\n      var _this5 = this;\n\n      (this.$refs.skuRows || []).forEach(function (it) {\n        var _ref = it.skuRow || {},\n            k_s = _ref.k_s;\n\n        it.centerItem(_this5.initialSku[k_s]);\n      });\n    }\n  },\n  render: function render() {\n    var _this6 = this;\n\n    var h = arguments[0];\n\n    if (this.isSkuEmpty) {\n      return;\n    }\n\n    var sku = this.sku,\n        skuList = this.skuList,\n        goods = this.goods,\n        price = this.price,\n        lazyLoad = this.lazyLoad,\n        originPrice = this.originPrice,\n        skuEventBus = this.skuEventBus,\n        selectedSku = this.selectedSku,\n        selectedProp = this.selectedProp,\n        selectedNum = this.selectedNum,\n        stepperTitle = this.stepperTitle,\n        selectedSkuComb = this.selectedSkuComb,\n        showHeaderImage = this.showHeaderImage,\n        disableSoldoutSku = this.disableSoldoutSku;\n    var slotsProps = {\n      price: price,\n      originPrice: originPrice,\n      selectedNum: selectedNum,\n      skuEventBus: skuEventBus,\n      selectedSku: selectedSku,\n      selectedSkuComb: selectedSkuComb\n    };\n\n    var slots = function slots(name) {\n      return _this6.slots(name, slotsProps);\n    };\n\n    var Header = slots('sku-header') || h(SkuHeader, {\n      \"attrs\": {\n        \"sku\": sku,\n        \"goods\": goods,\n        \"skuEventBus\": skuEventBus,\n        \"selectedSku\": selectedSku,\n        \"showHeaderImage\": showHeaderImage\n      }\n    }, [h(\"template\", {\n      \"slot\": \"sku-header-image-extra\"\n    }, [slots('sku-header-image-extra')]), slots('sku-header-price') || h(\"div\", {\n      \"class\": \"van-sku__goods-price\"\n    }, [h(\"span\", {\n      \"class\": \"van-sku__price-symbol\"\n    }, [\"\\uFFE5\"]), h(\"span\", {\n      \"class\": \"van-sku__price-num\"\n    }, [price]), this.priceTag && h(\"span\", {\n      \"class\": \"van-sku__price-tag\"\n    }, [this.priceTag])]), slots('sku-header-origin-price') || originPrice && h(SkuHeaderItem, [t('originPrice'), \" \\uFFE5\", originPrice]), !this.hideStock && h(SkuHeaderItem, [h(\"span\", {\n      \"class\": \"van-sku__stock\"\n    }, [this.stockText])]), this.hasSkuOrAttr && !this.hideSelectedText && h(SkuHeaderItem, [this.selectedText]), slots('sku-header-extra')]);\n    var Group = slots('sku-group') || this.hasSkuOrAttr && h(\"div\", {\n      \"class\": this.skuGroupClass\n    }, [this.skuTree.map(function (skuTreeItem) {\n      return h(SkuRow, {\n        \"attrs\": {\n          \"skuRow\": skuTreeItem\n        },\n        \"ref\": \"skuRows\",\n        \"refInFor\": true\n      }, [skuTreeItem.v.map(function (skuValue) {\n        return h(SkuRowItem, {\n          \"attrs\": {\n            \"skuList\": skuList,\n            \"lazyLoad\": lazyLoad,\n            \"skuValue\": skuValue,\n            \"skuKeyStr\": skuTreeItem.k_s,\n            \"selectedSku\": selectedSku,\n            \"skuEventBus\": skuEventBus,\n            \"disableSoldoutSku\": disableSoldoutSku,\n            \"largeImageMode\": skuTreeItem.largeImageMode\n          }\n        });\n      })]);\n    }), this.propList.map(function (skuTreeItem) {\n      return h(SkuRow, {\n        \"attrs\": {\n          \"skuRow\": skuTreeItem\n        }\n      }, [skuTreeItem.v.map(function (skuValue) {\n        return h(SkuRowPropItem, {\n          \"attrs\": {\n            \"skuValue\": skuValue,\n            \"skuKeyStr\": skuTreeItem.k_id + '',\n            \"selectedProp\": selectedProp,\n            \"skuEventBus\": skuEventBus,\n            \"multiple\": skuTreeItem.is_multiple\n          }\n        });\n      })]);\n    })]);\n    var Stepper = slots('sku-stepper') || h(SkuStepper, {\n      \"ref\": \"skuStepper\",\n      \"attrs\": {\n        \"stock\": this.stock,\n        \"quota\": this.quota,\n        \"quotaUsed\": this.quotaUsed,\n        \"startSaleNum\": this.startSaleNum,\n        \"skuEventBus\": skuEventBus,\n        \"selectedNum\": selectedNum,\n        \"stepperTitle\": stepperTitle,\n        \"skuStockNum\": sku.stock_num,\n        \"disableStepperInput\": this.disableStepperInput,\n        \"customStepperConfig\": this.customStepperConfig,\n        \"hideQuotaText\": this.hideQuotaText\n      },\n      \"on\": {\n        \"change\": function change(event) {\n          _this6.$emit('stepper-change', event);\n        }\n      }\n    });\n    var Messages = slots('sku-messages') || h(SkuMessages, {\n      \"ref\": \"skuMessages\",\n      \"attrs\": {\n        \"goodsId\": this.goodsId,\n        \"messageConfig\": this.messageConfig,\n        \"messages\": sku.messages\n      }\n    });\n    var Actions = slots('sku-actions') || h(SkuActions, {\n      \"attrs\": {\n        \"buyText\": this.buyText,\n        \"skuEventBus\": skuEventBus,\n        \"addCartText\": this.addCartText,\n        \"showAddCartBtn\": this.showAddCartBtn\n      }\n    });\n    return h(Popup, {\n      \"attrs\": {\n        \"round\": true,\n        \"closeable\": true,\n        \"position\": \"bottom\",\n        \"getContainer\": this.getContainer,\n        \"closeOnClickOverlay\": this.closeOnClickOverlay,\n        \"safeAreaInsetBottom\": this.safeAreaInsetBottom\n      },\n      \"class\": \"van-sku-container\",\n      \"on\": {\n        \"opened\": this.onOpened\n      },\n      \"model\": {\n        value: _this6.show,\n        callback: function callback($$v) {\n          _this6.show = $$v;\n        }\n      }\n    }, [Header, h(\"div\", {\n      \"class\": \"van-sku-body\",\n      \"style\": this.bodyStyle\n    }, [slots('sku-body-top'), Group, slots('extra-sku-group'), Stepper, Messages]), slots('sku-actions-top'), Actions]);\n  }\n});","map":{"version":3,"sources":["C:/Users/Lisp/Desktop/items/node_modules/vant/es/sku/Sku.js"],"names":["_extends","Vue","Popup","Toast","ImagePreview","SkuHeader","SkuHeaderItem","SkuRow","SkuRowItem","SkuRowPropItem","SkuStepper","SkuMessages","SkuActions","createNamespace","isEmpty","isAllSelected","isSkuChoosable","getSkuComb","getSelectedSkuValues","getSelectedPropValues","getSelectedProperties","LIMIT_TYPE","UNSELECTED_SKU_VALUE_ID","namespace","createComponent","bem","t","QUOTA_LIMIT","props","sku","Object","goods","value","Boolean","buyText","String","goodsId","Number","priceTag","lazyLoad","hideStock","properties","Array","addCartText","stepperTitle","getContainer","Function","hideQuotaText","hideSelectedText","resetStepperOnHide","customSkuValidator","disableStepperInput","resetSelectedSkuOnHide","quota","type","default","quotaUsed","startSaleNum","initialSku","_default","stockThreshold","showSoldoutSku","showAddCartBtn","disableSoldoutSku","customStepperConfig","showHeaderImage","previewOnClickImage","safeAreaInsetBottom","closeOnClickOverlay","bodyOffsetTop","messageConfig","initialMessages","placeholderMap","uploadImg","Promise","resolve","uploadMaxSize","data","selectedSku","selectedProp","selectedNum","show","watch","val","$emit","selectedSkuValues","selectedSkuComb","resetStepper","resetSelectedSku","skuTree","computed","skuGroupClass","bodyStyle","$isServer","maxHeight","window","innerHeight","isSkuCombSelected","_this","hasSku","propList","filter","i","is_necessary","some","k_id","length","isSkuEmpty","keys","none_sku","hasSkuOrAttr","skuComb","skuList","id","collection_id","price","Math","round","stock_num","property_price","selectedPropValues","reduce","acc","cur","toFixed","originPrice","origin_price","tree","list","imageList","picture","forEach","treeItem","v","vItem","imgUrl","previewImgUrl","img_url","indexOf","push","stock","stockNum","undefined","stockText","h","$createElement","stockFormatter","highlight","selectedText","_this2","values","concat","map","item","name","join","unselectedSku","k_s","k","unselectedProp","created","skuEventBus","$on","onSelect","onPropSelect","onNumChange","onPreviewImage","onOverLimit","onStepperState","onAddCart","onBuy","methods","skuStepper","$refs","num","stepperError","setCurrentNum","_this3","key","valueId","skuValues","$nextTick","skuValue","_this$initialSku$sele","_item$v","isHasConfigPrice","propValues","propValue","centerInitialSku","getSkuMessages","skuMessages","getMessages","getSkuCartMessages","getCartMessages","validateSkuMessages","validateMessages","validateSku","err","_extends2","_extends3","skuKeyStr","_extends4","arr","pos","splice","multiple","selectedValue","_this4","index","indexImage","image","params","images","startPosition","onClose","action","limitType","handleOverLimit","valid","onBuyOrAddCart","error","getSkuData","messages","cartMessages","onOpened","_this5","skuRows","it","_ref","skuRow","centerItem","render","_this6","arguments","slotsProps","slots","Header","Group","skuTreeItem","largeImageMode","is_multiple","Stepper","change","event","Messages","Actions","callback","$$v"],"mappings":"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","sourcesContent":["import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport Vue from 'vue';\nimport Popup from '../popup';\nimport Toast from '../toast';\nimport ImagePreview from '../image-preview';\nimport SkuHeader from './components/SkuHeader';\nimport SkuHeaderItem from './components/SkuHeaderItem';\nimport SkuRow from './components/SkuRow';\nimport SkuRowItem from './components/SkuRowItem';\nimport SkuRowPropItem from './components/SkuRowPropItem';\nimport SkuStepper from './components/SkuStepper';\nimport SkuMessages from './components/SkuMessages';\nimport SkuActions from './components/SkuActions';\nimport { createNamespace, isEmpty } from '../utils';\nimport { isAllSelected, isSkuChoosable, getSkuComb, getSelectedSkuValues, getSelectedPropValues, getSelectedProperties } from './utils/sku-helper';\nimport { LIMIT_TYPE, UNSELECTED_SKU_VALUE_ID } from './constants';\nvar namespace = createNamespace('sku');\nvar createComponent = namespace[0],\n    bem = namespace[1],\n    t = namespace[2];\nvar QUOTA_LIMIT = LIMIT_TYPE.QUOTA_LIMIT;\nexport default createComponent({\n  props: {\n    sku: Object,\n    goods: Object,\n    value: Boolean,\n    buyText: String,\n    goodsId: [Number, String],\n    priceTag: String,\n    lazyLoad: Boolean,\n    hideStock: Boolean,\n    properties: Array,\n    addCartText: String,\n    stepperTitle: String,\n    getContainer: [String, Function],\n    hideQuotaText: Boolean,\n    hideSelectedText: Boolean,\n    resetStepperOnHide: Boolean,\n    customSkuValidator: Function,\n    disableStepperInput: Boolean,\n    resetSelectedSkuOnHide: Boolean,\n    quota: {\n      type: Number,\n      default: 0\n    },\n    quotaUsed: {\n      type: Number,\n      default: 0\n    },\n    startSaleNum: {\n      type: Number,\n      default: 1\n    },\n    initialSku: {\n      type: Object,\n      default: function _default() {\n        return {};\n      }\n    },\n    stockThreshold: {\n      type: Number,\n      default: 50\n    },\n    showSoldoutSku: {\n      type: Boolean,\n      default: true\n    },\n    showAddCartBtn: {\n      type: Boolean,\n      default: true\n    },\n    disableSoldoutSku: {\n      type: Boolean,\n      default: true\n    },\n    customStepperConfig: {\n      type: Object,\n      default: function _default() {\n        return {};\n      }\n    },\n    showHeaderImage: {\n      type: Boolean,\n      default: true\n    },\n    previewOnClickImage: {\n      type: Boolean,\n      default: true\n    },\n    safeAreaInsetBottom: {\n      type: Boolean,\n      default: true\n    },\n    closeOnClickOverlay: {\n      type: Boolean,\n      default: true\n    },\n    bodyOffsetTop: {\n      type: Number,\n      default: 200\n    },\n    messageConfig: {\n      type: Object,\n      default: function _default() {\n        return {\n          initialMessages: {},\n          placeholderMap: {},\n          uploadImg: function uploadImg() {\n            return Promise.resolve();\n          },\n          uploadMaxSize: 5\n        };\n      }\n    }\n  },\n  data: function data() {\n    return {\n      selectedSku: {},\n      selectedProp: {},\n      selectedNum: 1,\n      show: this.value\n    };\n  },\n  watch: {\n    show: function show(val) {\n      this.$emit('input', val);\n\n      if (!val) {\n        this.$emit('sku-close', {\n          selectedSkuValues: this.selectedSkuValues,\n          selectedNum: this.selectedNum,\n          selectedSkuComb: this.selectedSkuComb\n        });\n\n        if (this.resetStepperOnHide) {\n          this.resetStepper();\n        }\n\n        if (this.resetSelectedSkuOnHide) {\n          this.resetSelectedSku();\n        }\n      }\n    },\n    value: function value(val) {\n      this.show = val;\n    },\n    skuTree: 'resetSelectedSku',\n    initialSku: function initialSku() {\n      this.resetStepper();\n      this.resetSelectedSku();\n    }\n  },\n  computed: {\n    skuGroupClass: function skuGroupClass() {\n      return ['van-sku-group-container', {\n        'van-sku-group-container--hide-soldout': !this.showSoldoutSku\n      }];\n    },\n    bodyStyle: function bodyStyle() {\n      if (this.$isServer) {\n        return;\n      }\n\n      var maxHeight = window.innerHeight - this.bodyOffsetTop;\n      return {\n        maxHeight: maxHeight + 'px'\n      };\n    },\n    isSkuCombSelected: function isSkuCombSelected() {\n      var _this = this;\n\n      // SKU 未选完\n      if (this.hasSku && !isAllSelected(this.skuTree, this.selectedSku)) {\n        return false;\n      } // 属性未全选\n\n\n      return !this.propList.filter(function (i) {\n        return i.is_necessary !== false;\n      }).some(function (i) {\n        return (_this.selectedProp[i.k_id] || []).length === 0;\n      });\n    },\n    isSkuEmpty: function isSkuEmpty() {\n      return Object.keys(this.sku).length === 0;\n    },\n    hasSku: function hasSku() {\n      return !this.sku.none_sku;\n    },\n    hasSkuOrAttr: function hasSkuOrAttr() {\n      return this.hasSku || this.propList.length > 0;\n    },\n    selectedSkuComb: function selectedSkuComb() {\n      var skuComb = null;\n\n      if (this.isSkuCombSelected) {\n        if (this.hasSku) {\n          skuComb = getSkuComb(this.skuList, this.selectedSku);\n        } else {\n          skuComb = {\n            id: this.sku.collection_id,\n            price: Math.round(this.sku.price * 100),\n            stock_num: this.sku.stock_num\n          };\n        }\n\n        if (skuComb) {\n          skuComb.properties = getSelectedProperties(this.propList, this.selectedProp);\n          skuComb.property_price = this.selectedPropValues.reduce(function (acc, cur) {\n            return acc + (cur.price || 0);\n          }, 0);\n        }\n      }\n\n      return skuComb;\n    },\n    selectedSkuValues: function selectedSkuValues() {\n      return getSelectedSkuValues(this.skuTree, this.selectedSku);\n    },\n    selectedPropValues: function selectedPropValues() {\n      return getSelectedPropValues(this.propList, this.selectedProp);\n    },\n    price: function price() {\n      if (this.selectedSkuComb) {\n        return ((this.selectedSkuComb.price + this.selectedSkuComb.property_price) / 100).toFixed(2);\n      } // sku.price是一个格式化好的价格区间\n\n\n      return this.sku.price;\n    },\n    originPrice: function originPrice() {\n      if (this.selectedSkuComb && this.selectedSkuComb.origin_price) {\n        return ((this.selectedSkuComb.origin_price + this.selectedSkuComb.property_price) / 100).toFixed(2);\n      }\n\n      return this.sku.origin_price;\n    },\n    skuTree: function skuTree() {\n      return this.sku.tree || [];\n    },\n    skuList: function skuList() {\n      return this.sku.list || [];\n    },\n    propList: function propList() {\n      return this.properties || [];\n    },\n    imageList: function imageList() {\n      var imageList = [this.goods.picture];\n\n      if (this.skuTree.length > 0) {\n        this.skuTree.forEach(function (treeItem) {\n          if (!treeItem.v) {\n            return;\n          }\n\n          treeItem.v.forEach(function (vItem) {\n            var imgUrl = vItem.previewImgUrl || vItem.imgUrl || vItem.img_url;\n\n            if (imgUrl && imageList.indexOf(imgUrl) === -1) {\n              imageList.push(imgUrl);\n            }\n          });\n        });\n      }\n\n      return imageList;\n    },\n    stock: function stock() {\n      var stockNum = this.customStepperConfig.stockNum;\n\n      if (stockNum !== undefined) {\n        return stockNum;\n      }\n\n      if (this.selectedSkuComb) {\n        return this.selectedSkuComb.stock_num;\n      }\n\n      return this.sku.stock_num;\n    },\n    stockText: function stockText() {\n      var h = this.$createElement;\n      var stockFormatter = this.customStepperConfig.stockFormatter;\n\n      if (stockFormatter) {\n        return stockFormatter(this.stock);\n      }\n\n      return [t('stock') + \" \", h(\"span\", {\n        \"class\": bem('stock-num', {\n          highlight: this.stock < this.stockThreshold\n        })\n      }, [this.stock]), \" \" + t('stockUnit')];\n    },\n    selectedText: function selectedText() {\n      var _this2 = this;\n\n      if (this.selectedSkuComb) {\n        var values = this.selectedSkuValues.concat(this.selectedPropValues);\n        return t('selected') + \" \" + values.map(function (item) {\n          return item.name;\n        }).join(' ');\n      }\n\n      var unselectedSku = this.skuTree.filter(function (item) {\n        return _this2.selectedSku[item.k_s] === UNSELECTED_SKU_VALUE_ID;\n      }).map(function (item) {\n        return item.k;\n      });\n      var unselectedProp = this.propList.filter(function (item) {\n        return (_this2.selectedProp[item.k_id] || []).length < 1;\n      }).map(function (item) {\n        return item.k;\n      });\n      return t('select') + \" \" + unselectedSku.concat(unselectedProp).join(' ');\n    }\n  },\n  created: function created() {\n    var skuEventBus = new Vue();\n    this.skuEventBus = skuEventBus;\n    skuEventBus.$on('sku:select', this.onSelect);\n    skuEventBus.$on('sku:propSelect', this.onPropSelect);\n    skuEventBus.$on('sku:numChange', this.onNumChange);\n    skuEventBus.$on('sku:previewImage', this.onPreviewImage);\n    skuEventBus.$on('sku:overLimit', this.onOverLimit);\n    skuEventBus.$on('sku:stepperState', this.onStepperState);\n    skuEventBus.$on('sku:addCart', this.onAddCart);\n    skuEventBus.$on('sku:buy', this.onBuy);\n    this.resetStepper();\n    this.resetSelectedSku(); // 组件初始化后的钩子，抛出skuEventBus\n\n    this.$emit('after-sku-create', skuEventBus);\n  },\n  methods: {\n    resetStepper: function resetStepper() {\n      var skuStepper = this.$refs.skuStepper;\n      var selectedNum = this.initialSku.selectedNum;\n      var num = selectedNum != null ? selectedNum : this.startSaleNum; // 用来缓存不合法的情况\n\n      this.stepperError = null;\n\n      if (skuStepper) {\n        skuStepper.setCurrentNum(num);\n      } else {\n        // 当首次加载（skuStepper 为空）时，传入数量如果不合法，可能会存在问题\n        this.selectedNum = num;\n      }\n    },\n    // @exposed-api\n    resetSelectedSku: function resetSelectedSku() {\n      var _this3 = this;\n\n      this.selectedSku = {}; // 重置 selectedSku\n\n      this.skuTree.forEach(function (item) {\n        _this3.selectedSku[item.k_s] = UNSELECTED_SKU_VALUE_ID;\n      });\n      this.skuTree.forEach(function (item) {\n        var key = item.k_s; // 规格值只有1个时，优先判断\n\n        var valueId = item.v.length === 1 ? item.v[0].id : _this3.initialSku[key];\n\n        if (valueId && isSkuChoosable(_this3.skuList, _this3.selectedSku, {\n          key: key,\n          valueId: valueId\n        })) {\n          _this3.selectedSku[key] = valueId;\n        }\n      });\n      var skuValues = this.selectedSkuValues;\n\n      if (skuValues.length > 0) {\n        this.$nextTick(function () {\n          _this3.$emit('sku-selected', {\n            skuValue: skuValues[skuValues.length - 1],\n            selectedSku: _this3.selectedSku,\n            selectedSkuComb: _this3.selectedSkuComb\n          });\n        });\n      } // 重置商品属性\n\n\n      this.selectedProp = {};\n      var _this$initialSku$sele = this.initialSku.selectedProp,\n          selectedProp = _this$initialSku$sele === void 0 ? {} : _this$initialSku$sele; // 选中外部传入信息\n\n      this.propList.forEach(function (item) {\n        if (selectedProp[item.k_id]) {\n          _this3.selectedProp[item.k_id] = selectedProp[item.k_id];\n        }\n      });\n\n      if (isEmpty(this.selectedProp)) {\n        this.propList.forEach(function (item) {\n          var _item$v;\n\n          // 没有加价的属性，默认选中第一个\n          if ((item == null ? void 0 : (_item$v = item.v) == null ? void 0 : _item$v.length) > 0) {\n            var v = item.v,\n                k_id = item.k_id;\n            var isHasConfigPrice = v.some(function (i) {\n              return +i.price !== 0;\n            });\n\n            if (!isHasConfigPrice) {\n              _this3.selectedProp[k_id] = [v[0].id];\n            }\n          }\n        });\n      }\n\n      var propValues = this.selectedPropValues;\n\n      if (propValues.length > 0) {\n        this.$emit('sku-prop-selected', {\n          propValue: propValues[propValues.length - 1],\n          selectedProp: this.selectedProp,\n          selectedSkuComb: this.selectedSkuComb\n        });\n      } // 抛出重置事件\n\n\n      this.$emit('sku-reset', {\n        selectedSku: this.selectedSku,\n        selectedProp: this.selectedProp,\n        selectedSkuComb: this.selectedSkuComb\n      });\n      this.centerInitialSku();\n    },\n    getSkuMessages: function getSkuMessages() {\n      return this.$refs.skuMessages ? this.$refs.skuMessages.getMessages() : {};\n    },\n    getSkuCartMessages: function getSkuCartMessages() {\n      return this.$refs.skuMessages ? this.$refs.skuMessages.getCartMessages() : {};\n    },\n    validateSkuMessages: function validateSkuMessages() {\n      return this.$refs.skuMessages ? this.$refs.skuMessages.validateMessages() : '';\n    },\n    validateSku: function validateSku() {\n      if (this.selectedNum === 0) {\n        return t('unavailable');\n      }\n\n      if (this.isSkuCombSelected) {\n        return this.validateSkuMessages();\n      } // 自定义sku校验\n\n\n      if (this.customSkuValidator) {\n        var err = this.customSkuValidator(this);\n        if (err) return err;\n      }\n\n      return t('selectSku');\n    },\n    onSelect: function onSelect(skuValue) {\n      var _extends2, _extends3;\n\n      // 点击已选中的sku时则取消选中\n      this.selectedSku = this.selectedSku[skuValue.skuKeyStr] === skuValue.id ? _extends({}, this.selectedSku, (_extends2 = {}, _extends2[skuValue.skuKeyStr] = UNSELECTED_SKU_VALUE_ID, _extends2)) : _extends({}, this.selectedSku, (_extends3 = {}, _extends3[skuValue.skuKeyStr] = skuValue.id, _extends3));\n      this.$emit('sku-selected', {\n        skuValue: skuValue,\n        selectedSku: this.selectedSku,\n        selectedSkuComb: this.selectedSkuComb\n      });\n    },\n    onPropSelect: function onPropSelect(propValue) {\n      var _extends4;\n\n      var arr = this.selectedProp[propValue.skuKeyStr] || [];\n      var pos = arr.indexOf(propValue.id);\n\n      if (pos > -1) {\n        arr.splice(pos, 1);\n      } else if (propValue.multiple) {\n        arr.push(propValue.id);\n      } else {\n        arr.splice(0, 1, propValue.id);\n      }\n\n      this.selectedProp = _extends({}, this.selectedProp, (_extends4 = {}, _extends4[propValue.skuKeyStr] = arr, _extends4));\n      this.$emit('sku-prop-selected', {\n        propValue: propValue,\n        selectedProp: this.selectedProp,\n        selectedSkuComb: this.selectedSkuComb\n      });\n    },\n    onNumChange: function onNumChange(num) {\n      this.selectedNum = num;\n    },\n    onPreviewImage: function onPreviewImage(selectedValue) {\n      var _this4 = this;\n\n      var imageList = this.imageList;\n      var index = 0;\n      var indexImage = imageList[0];\n\n      if (selectedValue && selectedValue.imgUrl) {\n        this.imageList.some(function (image, pos) {\n          if (image === selectedValue.imgUrl) {\n            index = pos;\n            return true;\n          }\n\n          return false;\n        });\n        indexImage = selectedValue.imgUrl;\n      }\n\n      var params = _extends({}, selectedValue, {\n        index: index,\n        imageList: this.imageList,\n        indexImage: indexImage\n      });\n\n      this.$emit('open-preview', params);\n\n      if (!this.previewOnClickImage) {\n        return;\n      }\n\n      ImagePreview({\n        images: this.imageList,\n        startPosition: index,\n        onClose: function onClose() {\n          _this4.$emit('close-preview', params);\n        }\n      });\n    },\n    onOverLimit: function onOverLimit(data) {\n      var action = data.action,\n          limitType = data.limitType,\n          quota = data.quota,\n          quotaUsed = data.quotaUsed;\n      var handleOverLimit = this.customStepperConfig.handleOverLimit;\n\n      if (handleOverLimit) {\n        handleOverLimit(data);\n        return;\n      }\n\n      if (action === 'minus') {\n        if (this.startSaleNum > 1) {\n          Toast(t('minusStartTip', this.startSaleNum));\n        } else {\n          Toast(t('minusTip'));\n        }\n      } else if (action === 'plus') {\n        if (limitType === QUOTA_LIMIT) {\n          if (quotaUsed > 0) {\n            Toast(t('quotaUsedTip', quota, quotaUsed));\n          } else {\n            Toast(t('quotaTip', quota));\n          }\n        } else {\n          Toast(t('soldout'));\n        }\n      }\n    },\n    onStepperState: function onStepperState(data) {\n      this.stepperError = data.valid ? null : _extends({}, data, {\n        action: 'plus'\n      });\n    },\n    onAddCart: function onAddCart() {\n      this.onBuyOrAddCart('add-cart');\n    },\n    onBuy: function onBuy() {\n      this.onBuyOrAddCart('buy-clicked');\n    },\n    onBuyOrAddCart: function onBuyOrAddCart(type) {\n      // sku 不符合购买条件\n      if (this.stepperError) {\n        return this.onOverLimit(this.stepperError);\n      }\n\n      var error = this.validateSku();\n\n      if (error) {\n        Toast(error);\n      } else {\n        this.$emit(type, this.getSkuData());\n      }\n    },\n    // @exposed-api\n    getSkuData: function getSkuData() {\n      return {\n        goodsId: this.goodsId,\n        messages: this.getSkuMessages(),\n        selectedNum: this.selectedNum,\n        cartMessages: this.getSkuCartMessages(),\n        selectedSkuComb: this.selectedSkuComb\n      };\n    },\n    // 当 popup 完全打开后执行\n    onOpened: function onOpened() {\n      this.centerInitialSku();\n    },\n    centerInitialSku: function centerInitialSku() {\n      var _this5 = this;\n\n      (this.$refs.skuRows || []).forEach(function (it) {\n        var _ref = it.skuRow || {},\n            k_s = _ref.k_s;\n\n        it.centerItem(_this5.initialSku[k_s]);\n      });\n    }\n  },\n  render: function render() {\n    var _this6 = this;\n\n    var h = arguments[0];\n\n    if (this.isSkuEmpty) {\n      return;\n    }\n\n    var sku = this.sku,\n        skuList = this.skuList,\n        goods = this.goods,\n        price = this.price,\n        lazyLoad = this.lazyLoad,\n        originPrice = this.originPrice,\n        skuEventBus = this.skuEventBus,\n        selectedSku = this.selectedSku,\n        selectedProp = this.selectedProp,\n        selectedNum = this.selectedNum,\n        stepperTitle = this.stepperTitle,\n        selectedSkuComb = this.selectedSkuComb,\n        showHeaderImage = this.showHeaderImage,\n        disableSoldoutSku = this.disableSoldoutSku;\n    var slotsProps = {\n      price: price,\n      originPrice: originPrice,\n      selectedNum: selectedNum,\n      skuEventBus: skuEventBus,\n      selectedSku: selectedSku,\n      selectedSkuComb: selectedSkuComb\n    };\n\n    var slots = function slots(name) {\n      return _this6.slots(name, slotsProps);\n    };\n\n    var Header = slots('sku-header') || h(SkuHeader, {\n      \"attrs\": {\n        \"sku\": sku,\n        \"goods\": goods,\n        \"skuEventBus\": skuEventBus,\n        \"selectedSku\": selectedSku,\n        \"showHeaderImage\": showHeaderImage\n      }\n    }, [h(\"template\", {\n      \"slot\": \"sku-header-image-extra\"\n    }, [slots('sku-header-image-extra')]), slots('sku-header-price') || h(\"div\", {\n      \"class\": \"van-sku__goods-price\"\n    }, [h(\"span\", {\n      \"class\": \"van-sku__price-symbol\"\n    }, [\"\\uFFE5\"]), h(\"span\", {\n      \"class\": \"van-sku__price-num\"\n    }, [price]), this.priceTag && h(\"span\", {\n      \"class\": \"van-sku__price-tag\"\n    }, [this.priceTag])]), slots('sku-header-origin-price') || originPrice && h(SkuHeaderItem, [t('originPrice'), \" \\uFFE5\", originPrice]), !this.hideStock && h(SkuHeaderItem, [h(\"span\", {\n      \"class\": \"van-sku__stock\"\n    }, [this.stockText])]), this.hasSkuOrAttr && !this.hideSelectedText && h(SkuHeaderItem, [this.selectedText]), slots('sku-header-extra')]);\n    var Group = slots('sku-group') || this.hasSkuOrAttr && h(\"div\", {\n      \"class\": this.skuGroupClass\n    }, [this.skuTree.map(function (skuTreeItem) {\n      return h(SkuRow, {\n        \"attrs\": {\n          \"skuRow\": skuTreeItem\n        },\n        \"ref\": \"skuRows\",\n        \"refInFor\": true\n      }, [skuTreeItem.v.map(function (skuValue) {\n        return h(SkuRowItem, {\n          \"attrs\": {\n            \"skuList\": skuList,\n            \"lazyLoad\": lazyLoad,\n            \"skuValue\": skuValue,\n            \"skuKeyStr\": skuTreeItem.k_s,\n            \"selectedSku\": selectedSku,\n            \"skuEventBus\": skuEventBus,\n            \"disableSoldoutSku\": disableSoldoutSku,\n            \"largeImageMode\": skuTreeItem.largeImageMode\n          }\n        });\n      })]);\n    }), this.propList.map(function (skuTreeItem) {\n      return h(SkuRow, {\n        \"attrs\": {\n          \"skuRow\": skuTreeItem\n        }\n      }, [skuTreeItem.v.map(function (skuValue) {\n        return h(SkuRowPropItem, {\n          \"attrs\": {\n            \"skuValue\": skuValue,\n            \"skuKeyStr\": skuTreeItem.k_id + '',\n            \"selectedProp\": selectedProp,\n            \"skuEventBus\": skuEventBus,\n            \"multiple\": skuTreeItem.is_multiple\n          }\n        });\n      })]);\n    })]);\n    var Stepper = slots('sku-stepper') || h(SkuStepper, {\n      \"ref\": \"skuStepper\",\n      \"attrs\": {\n        \"stock\": this.stock,\n        \"quota\": this.quota,\n        \"quotaUsed\": this.quotaUsed,\n        \"startSaleNum\": this.startSaleNum,\n        \"skuEventBus\": skuEventBus,\n        \"selectedNum\": selectedNum,\n        \"stepperTitle\": stepperTitle,\n        \"skuStockNum\": sku.stock_num,\n        \"disableStepperInput\": this.disableStepperInput,\n        \"customStepperConfig\": this.customStepperConfig,\n        \"hideQuotaText\": this.hideQuotaText\n      },\n      \"on\": {\n        \"change\": function change(event) {\n          _this6.$emit('stepper-change', event);\n        }\n      }\n    });\n    var Messages = slots('sku-messages') || h(SkuMessages, {\n      \"ref\": \"skuMessages\",\n      \"attrs\": {\n        \"goodsId\": this.goodsId,\n        \"messageConfig\": this.messageConfig,\n        \"messages\": sku.messages\n      }\n    });\n    var Actions = slots('sku-actions') || h(SkuActions, {\n      \"attrs\": {\n        \"buyText\": this.buyText,\n        \"skuEventBus\": skuEventBus,\n        \"addCartText\": this.addCartText,\n        \"showAddCartBtn\": this.showAddCartBtn\n      }\n    });\n    return h(Popup, {\n      \"attrs\": {\n        \"round\": true,\n        \"closeable\": true,\n        \"position\": \"bottom\",\n        \"getContainer\": this.getContainer,\n        \"closeOnClickOverlay\": this.closeOnClickOverlay,\n        \"safeAreaInsetBottom\": this.safeAreaInsetBottom\n      },\n      \"class\": \"van-sku-container\",\n      \"on\": {\n        \"opened\": this.onOpened\n      },\n      \"model\": {\n        value: _this6.show,\n        callback: function callback($$v) {\n          _this6.show = $$v;\n        }\n      }\n    }, [Header, h(\"div\", {\n      \"class\": \"van-sku-body\",\n      \"style\": this.bodyStyle\n    }, [slots('sku-body-top'), Group, slots('extra-sku-group'), Stepper, Messages]), slots('sku-actions-top'), Actions]);\n  }\n});"]},"metadata":{},"sourceType":"module"}